---
ID: 081
Origin: 081
UUID: b7c4e2a1
Status: Active
---

# Analysis 081: DB ì „ì²´ ê°œì„  ì‘ì—… ì˜í–¥ë„ ë¶„ì„ ë° 3ë“±ë¶„ ê¸°ì¤€

> **ìƒì„±ì¼**: 2026-01-09  
> **ë¶„ì„ ëŒ€ìƒ**: Plan 081 (ë°ì´í„° ìµœì í™” ë§ˆìŠ¤í„° í”Œëœ)  
> **ëª©ì **: ì‹¤í–‰ ì „ ì „ë°©ìœ„ì  ì˜í–¥ë„ íŒŒì•… ë° Phase ë¶„í•  ê¸°ì¤€ ì œì•ˆ

---

## 1. Value Statement

Plan 081 ì‹¤í–‰ ì „ **ì½”ë“œë² ì´ìŠ¤ ì „ì²´ì— ë¯¸ì¹˜ëŠ” ì˜í–¥**ì„ ì •ë°€ ë¶„ì„í•˜ì—¬:
- ìˆ¨ê²¨ì§„ ì˜ì¡´ì„±ìœ¼ë¡œ ì¸í•œ ëŸ°íƒ€ì„ ì˜¤ë¥˜ ë°©ì§€
- ë³€ê²½ ìˆœì„œ ìµœì í™”ë¡œ ë¡¤ë°± ë¦¬ìŠ¤í¬ ìµœì†Œí™”
- ë³‘ë ¬ ì‘ì—… ê°€ëŠ¥ ì˜ì—­ ì‹ë³„ë¡œ ê°œë°œ íš¨ìœ¨ ê·¹ëŒ€í™”

---

## 2. ì˜í–¥ë°›ëŠ” íŒŒì¼ ëª©ë¡

### 2.1 ì§ì ‘ ìˆ˜ì • ëŒ€ìƒ

| íŒŒì¼ ê²½ë¡œ | ë³€ê²½ ì‚¬ìœ  | ì˜ˆìƒ ë‚œì´ë„ |
|-----------|----------|-------------|
| [src/shared/services/sync/firebase/strategies.ts](src/shared/services/sync/firebase/strategies.ts) | ItemSyncStrategy ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€, weeklyGoalStrategy/globalInboxStrategy/templateStrategy ìˆ˜ì • | ğŸ”´ High |
| [src/shared/services/sync/firebase/syncCore.ts](src/shared/services/sync/firebase/syncCore.ts) | syncItemToFirebase() í•¨ìˆ˜ ì¶”ê°€, ë‹¨ì¼ í•­ëª© ë™ê¸°í™” ë¡œì§ | ğŸ”´ High |
| [src/data/repositories/weeklyGoalRepository.ts](src/data/repositories/weeklyGoalRepository.ts) | ì „ì²´ ì¬ì—…ë¡œë“œ â†’ ë‹¨ì¼ í•­ëª© ì—…ë¡œë“œ, ë°˜í™˜ íƒ€ì… ë³€ê²½ | ğŸŸ  Medium |
| [src/data/repositories/inboxRepository.ts](src/data/repositories/inboxRepository.ts) | Collection Sync â†’ Item Sync ì „í™˜, syncGlobalInboxToFirebase ìˆ˜ì • | ğŸŸ  Medium |
| [src/data/repositories/templateRepository.ts](src/data/repositories/templateRepository.ts) | Firebase ë™ê¸°í™” ë¡œì§ ì¶”ê°€ (í˜„ì¬ ë¯¸êµ¬í˜„) | ğŸŸ  Medium |
| [src/shared/subscribers/index.ts](src/shared/subscribers/index.ts) | task:completed ë°°ì¹˜ ì²˜ë¦¬ ì˜µì…˜ ì¶”ê°€ | ğŸŸ¢ Low |
| [src/shared/subscribers/xpSubscriber.ts](src/shared/subscribers/xpSubscriber.ts) | ë°°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€ (ì„ íƒ) | ğŸŸ¢ Low |
| [src/shared/subscribers/waifuSubscriber.ts](src/shared/subscribers/waifuSubscriber.ts) | ë°°ì¹˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€ (ì„ íƒ) | ğŸŸ¢ Low |
| [src/shared/subscribers/gameStateSubscriber.ts](src/shared/subscribers/gameStateSubscriber.ts) | ë°°ì¹˜ í€˜ìŠ¤íŠ¸ ì§„í–‰ ì²˜ë¦¬ | ğŸŸ¢ Low |
| [src/shared/subscribers/googleSyncSubscriber.ts](src/shared/subscribers/googleSyncSubscriber.ts) | ë°°ì¹˜ Calendar ë™ê¸°í™” ìµœì í™” | ğŸŸ¢ Low |
| [src/data/db/infra/syncEngine/lifecycle.ts](src/data/db/infra/syncEngine/lifecycle.ts) | Debounce ì‹œê°„ ì¡°ì • (300ms ì ìš©) | ğŸŸ¢ Low |
| [src/shared/utils/firebaseGuard.ts](src/shared/utils/firebaseGuard.ts) | Debounced sync ë˜í¼ í•¨ìˆ˜ ì¶”ê°€ | ğŸŸ¢ Low |

### 2.2 ê°„ì ‘ ì˜í–¥ ëŒ€ìƒ (ê²€ì¦/í…ŒìŠ¤íŠ¸ í•„ìš”)

| íŒŒì¼ ê²½ë¡œ | ì˜í–¥ ì‚¬ìœ  |
|-----------|----------|
| [src/shared/stores/weeklyGoalStore.ts](src/shared/stores/weeklyGoalStore.ts) | Repository ë°˜í™˜ íƒ€ì… ë³€ê²½ ì‹œ `addGoal`, `updateGoal` ë¡œì§ ì¡°ì • í•„ìš” |
| [src/shared/stores/inboxStore.ts](src/shared/stores/inboxStore.ts) | Repository ë™ê¸°í™” íŒ¨í„´ ë³€ê²½ í™•ì¸ |
| [src/shared/stores/templateStore.ts](src/shared/stores/templateStore.ts) | Firebase ë™ê¸°í™” ì¶”ê°€ ì‹œ Store ì—°ë™ |
| [src/shared/stores/dailyDataStore.ts](src/shared/stores/dailyDataStore.ts) | EventBus task:completed ë°°ì¹˜ ì²˜ë¦¬ ì‹œ ì´ë²¤íŠ¸ ë°œí–‰ íŒ¨í„´ í™•ì¸ |
| [src/shared/stores/gameStateStore.ts](src/shared/stores/gameStateStore.ts) | í€˜ìŠ¤íŠ¸ ì§„í–‰ ë°°ì¹˜ ì²˜ë¦¬ ì˜í–¥ |
| [src/data/repositories/dailyData/taskOperations.ts](src/data/repositories/dailyData/taskOperations.ts) | inboxRepository ë³€ê²½ ì‹œ inboxâ†”dailyData ì´ë™ ë¡œì§ í™•ì¸ |
| [src/shared/lib/eventBus/types.ts](src/shared/lib/eventBus/types.ts) | ë°°ì¹˜ ì´ë²¤íŠ¸ íƒ€ì… ì¶”ê°€ ì‹œ ìˆ˜ì • í•„ìš” |
| [tests/sync-strategies-contract.test.ts](tests/sync-strategies-contract.test.ts) | Strategy ë³€ê²½ ì‹œ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•„ìˆ˜ |
| [tests/task-completion-handlers.test.ts](tests/task-completion-handlers.test.ts) | EventBus íŒ¨í„´ ë³€ê²½ ì‹œ í…ŒìŠ¤íŠ¸ í™•ì¸ |

---

## 3. ì˜ì¡´ì„± ê·¸ë˜í”„

### 3.1 Sync ë ˆì´ì–´ ì˜ì¡´ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SYNC LAYER                                       â”‚
â”‚                                                                              â”‚
â”‚  strategies.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚                                                    â”‚                 â”‚
â”‚       â”‚ defines                                            â”‚ uses            â”‚
â”‚       â–¼                                                    â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ SyncStrategy   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  syncCore.ts    â”‚         â”‚
â”‚  â”‚ <T>            â”‚                              â”‚  - syncToFirebase()        â”‚
â”‚  â”‚                â”‚                              â”‚  - fetchFromFirebase()     â”‚
â”‚  â”‚ â€¢ weeklyGoal   â”‚                              â”‚  - listenToFirebase()      â”‚
â”‚  â”‚ â€¢ globalInbox  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”‚ â€¢ template     â”‚                                      â”‚                   â”‚
â”‚  â”‚ â€¢ dailyData    â”‚                                      â”‚                   â”‚
â”‚  â”‚ â€¢ gameState    â”‚                                      â”‚                   â”‚
â”‚  â”‚ â€¢ ...          â”‚                                      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚                   â”‚
â”‚                                                          â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚                               â”‚
                                           â–¼                               â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚  firebaseGuard.ts     â”‚       â”‚  syncRetryQueue.tsâ”‚
                               â”‚  - withFirebaseSync() â”‚       â”‚  - addToRetryQueueâ”‚
                               â”‚  - withFirebaseFetch()â”‚       â”‚  - drainRetryQueueâ”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Repository â†’ Store â†’ Feature ì˜ì¡´ ì²´ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW CHAIN                                        â”‚
â”‚                                                                                 â”‚
â”‚   REPOSITORY LAYER              STORE LAYER               FEATURE LAYER         â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚weeklyGoalRepository â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ weeklyGoalStore    â”‚â”€â”€â”€â–¶â”‚ WeeklyGoalPanel   â”‚ â”‚
â”‚  â”‚â€¢ loadWeeklyGoals()  â”‚      â”‚ â€¢ goals: []         â”‚    â”‚ WeeklyGoalCard    â”‚ â”‚
â”‚  â”‚â€¢ addWeeklyGoal()    â”‚      â”‚ â€¢ addGoal()         â”‚    â”‚ WeeklyGoalModal   â”‚ â”‚
â”‚  â”‚â€¢ updateWeeklyGoal() â”‚      â”‚ â€¢ updateGoal()      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚â€¢ deleteWeeklyGoal() â”‚      â”‚ â€¢ deleteGoal()      â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                            â”‚                                        â”‚
â”‚           â”‚ Firebase Sync              â”‚ EventBus                               â”‚
â”‚           â–¼                            â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ syncCore.ts         â”‚      â”‚ eventBus            â”‚                           â”‚
â”‚  â”‚ (strategies.ts)     â”‚      â”‚ â€¢ emit()            â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â€¢ on()              â”‚                           â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                          â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚inboxRepository      â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ inboxStore         â”‚                           â”‚
â”‚  â”‚â€¢ loadInboxTasks()   â”‚      â”‚ â€¢ inboxTasks: []    â”‚                           â”‚
â”‚  â”‚â€¢ addInboxTask()     â”‚      â”‚ â€¢ addTask()         â”‚                           â”‚
â”‚  â”‚â€¢ toggleInboxTaskCom â”‚      â”‚ â€¢ toggleTaskCompl() â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚           â”‚                            â”‚                                        â”‚
â”‚           â–¼                            â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚templateRepository   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ templateStore      â”‚                           â”‚
â”‚  â”‚â€¢ loadTemplates()    â”‚      â”‚ (Firebase sync ë¯¸êµ¬í˜„)                          â”‚
â”‚  â”‚â€¢ createTemplate()   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 EventBus ì´ë²¤íŠ¸ ë°œí–‰/êµ¬ë… ë§µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EVENTBUS TOPOLOGY                                       â”‚
â”‚                                                                                 â”‚
â”‚  PUBLISHERS (emit)                        SUBSCRIBERS (on)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚                                                                                 â”‚
â”‚  dailyDataStore.toggleTaskCompletion()                                          â”‚
â”‚  inboxStore.toggleTaskCompletion()        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚           â”‚                               â”‚                                  â”‚  â”‚
â”‚           â””â”€â”€â”€â”€ task:completed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  xpSubscriber                    â”‚  â”‚
â”‚                      â”‚                    â”‚  â€¢ XP ì²˜ë¦¬ (í˜„ì¬ëŠ” ìŠ¤í‚µ)          â”‚  â”‚
â”‚                      â”‚                    â”‚                                  â”‚  â”‚
â”‚                      â”‚                    â”‚  waifuSubscriber                 â”‚  â”‚
â”‚                      â”‚                    â”‚  â€¢ ì¶•í•˜ ë©”ì‹œì§€ í‘œì‹œ               â”‚  â”‚
â”‚                      â”‚                    â”‚                                  â”‚  â”‚
â”‚                      â”‚                    â”‚  gameStateSubscriber             â”‚  â”‚
â”‚                      â”‚                    â”‚  â€¢ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ +1              â”‚  â”‚
â”‚                      â”‚                    â”‚                                  â”‚  â”‚
â”‚                      â”‚                    â”‚  googleSyncSubscriber            â”‚  â”‚
â”‚                      â”‚                    â”‚  â€¢ Calendar ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸      â”‚  â”‚
â”‚                      â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                                          â”‚
â”‚                      â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ì—°ì‡„ ë°˜ì‘ ìˆœì„œ (ë™ê¸° ì‹¤í–‰):                                               â”‚    â”‚
â”‚  â”‚   1. xpSubscriber        â†’ addXP() (í˜„ì¬ ìŠ¤í‚µ)                          â”‚    â”‚
â”‚  â”‚   2. waifuSubscriber     â†’ show() ì¶•í•˜ ë©”ì‹œì§€                           â”‚    â”‚
â”‚  â”‚   3. gameStateSubscriber â†’ updateQuestProgress('complete_tasks', 1)   â”‚    â”‚
â”‚  â”‚   4. googleSyncSubscriberâ†’ handleTaskSync(taskId, 'update')           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚  OTHER EVENTS:                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚  inbox:taskRemoved â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ inboxSubscriber (ìƒíƒœ ì¦‰ì‹œ ë°˜ì˜)                  â”‚
â”‚  gameState:refreshRequest â”€â”€â–¶ gameStateSubscriber (GameState ê°±ì‹ )              â”‚
â”‚  block:perfect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ xpSubscriber + gameStateSubscriber               â”‚
â”‚  block:locked â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ gameStateSubscriber (í€˜ìŠ¤íŠ¸ ì§„í–‰)                 â”‚
â”‚  tempSchedule:* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ googleSyncSubscriber (Calendar ë™ê¸°í™”)           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ë¦¬ìŠ¤í¬ ìš”ì†Œ

| ë¦¬ìŠ¤í¬ | ì‹¬ê°ë„ | ë°œìƒ ì¡°ê±´ | ì™„í™” ë°©ì•ˆ |
|--------|--------|-----------|-----------|
| **Firebase ê²½ë¡œ ë³€ê²½ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° ìœ ì‹¤** | ğŸ”´ Critical | Collection â†’ Item ì „í™˜ ì‹œ `users/{uid}/weeklyGoals` â†’ `users/{uid}/weeklyGoals/{goalId}` ê²½ë¡œ ë³€ê²½ | ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì„ í–‰ ì‹¤í–‰, Feature flagë¡œ ì ì§„ì  ë¡¤ì•„ì›ƒ, êµ¬ ê²½ë¡œ ì½ê¸° í´ë°± ìœ ì§€ |
| **ë©€í‹° ê¸°ê¸° ë™ê¸°í™” ì¶©ëŒ** | ğŸŸ  High | ë‘ ê¸°ê¸°ì—ì„œ ë™ì‹œì— ê°™ì€ Goal ìˆ˜ì • | LWW ì „ëµ ìœ ì§€, ì¶©ëŒ ë°œìƒ ì‹œ ë¡œê·¸ ê¸°ë¡, ì¶©ëŒ í•´ê²° UI ê³ ë ¤ |
| **Repository ë°˜í™˜ íƒ€ì… ë³€ê²½ìœ¼ë¡œ Store ì˜¤ë¥˜** | ğŸŸ  High | `addWeeklyGoal(): WeeklyGoal[]` â†’ `addWeeklyGoal(): WeeklyGoal` ë³€ê²½ ì‹œ Storeì—ì„œ ë°°ì—´ ê¸°ëŒ€ | Store ì½”ë“œ ë™ì‹œ ìˆ˜ì •, TypeScript ì»´íŒŒì¼ ì—ëŸ¬ë¡œ ì‚¬ì „ ê°ì§€ |
| **EventBus ë°°ì¹˜ ì²˜ë¦¬ë¡œ UI ë°˜ì‘ì„± ì €í•˜** | ğŸŸ¡ Medium | ì—°ì† ì‘ì—… ì™„ë£Œ ì‹œ 300ms ì§€ì—° | ë‹¨ì¼ ì´ë²¤íŠ¸ëŠ” ê¸°ì¡´ëŒ€ë¡œ ì¦‰ì‹œ ì²˜ë¦¬, ë°°ì¹˜ëŠ” ì˜µíŠ¸ì¸ ë°©ì‹ |
| **Debounceë¡œ ë°ì´í„° ìœ ì‹¤** | ğŸŸ¡ Medium | Debounce ëŒ€ê¸° ì¤‘ ì•± ì¢…ë£Œ | `beforeunload` ì´ë²¤íŠ¸ì—ì„œ flush í•¨ìˆ˜ í˜¸ì¶œ, ê°•ì œ ë™ê¸°í™” |
| **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¶€ì¡±** | ğŸŸ¡ Medium | ì‹ ê·œ ë¡œì§ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ëˆ„ë½ | PRë³„ í…ŒìŠ¤íŠ¸ ì‘ì„± í•„ìˆ˜í™”, ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ |
| **Template Firebase ë™ê¸°í™” ì¶”ê°€ ì‹œ ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸°** | ğŸŸ¡ Medium | ë¡œì»¬ì—ë§Œ ìˆë˜ Templateì´ Firebase ë™ê¸°í™” ì‹œ ì¶©ëŒ | ì´ˆê¸° ì—…ë¡œë“œ ì‹œ merge ì „ëµ ì ìš©, ì²« ë™ê¸°í™” ì‹œ ë¡œì»¬ ìš°ì„  |

---

## 5. 3ë“±ë¶„ ë¶„í•  ì œì•ˆ

### Phase A (1/3) - ê¸°ë°˜ ì¸í”„ë¼

> **ëª©í‘œ**: ìƒˆë¡œìš´ ë™ê¸°í™” íŒ¨í„´ì˜ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ë˜, **ê¸°ì¡´ ë™ì‘ì— ì˜í–¥ ì—†ì´** ë³‘ë ¬ ì‘ì—… ê°€ëŠ¥í•œ ê¸°ë°˜ ë§ˆë ¨

| í•­ëª© | íŒŒì¼ | ì„¤ëª… | ì‹œê°„ |
|------|------|------|------|
| **A-1** | strategies.ts, syncCore.ts | `ItemSyncStrategy<T>` ì¸í„°í˜ì´ìŠ¤ ì •ì˜, `syncItemToFirebase()` í•¨ìˆ˜ ì¶”ê°€ (ê¸°ì¡´ í•¨ìˆ˜ì™€ ê³µì¡´) | 3h |
| **A-2** | firebaseGuard.ts | `withFirebaseSyncDebounced()` ë˜í¼ í•¨ìˆ˜ ì¶”ê°€ | 1h |
| **A-3** | eventBus/types.ts | `task:completedBatch` íƒ€ì… ì¶”ê°€ (ê¸°ì¡´ íƒ€ì… ìœ ì§€) | 0.5h |
| **A-4** | tests/* | ìƒˆ ì¸í„°í˜ì´ìŠ¤/í•¨ìˆ˜ì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | 2h |

**ì™„ë£Œ ê¸°ì¤€**:
- ìƒˆ ì¸í„°í˜ì´ìŠ¤ê°€ TypeScript ì»´íŒŒì¼ í†µê³¼
- ê¸°ì¡´ `syncToFirebase()` ë™ì‘ ë¶ˆë³€
- ëª¨ë“  ì‹ ê·œ í…ŒìŠ¤íŠ¸ í†µê³¼

**ì˜ì¡´ì„±**: ì—†ìŒ (ë…ë¦½ ì‘ì—…)

---

### Phase B (2/3) - í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

> **ëª©í‘œ**: Collection Sync â†’ Item Sync ì „í™˜ ë° Repository ì¿¼ë¦¬ ìµœì í™” ì‹¤ì œ ì ìš©

| í•­ëª© | íŒŒì¼ | ì„¤ëª… | ì‹œê°„ |
|------|------|------|------|
| **B-1** | weeklyGoalRepository.ts | Item Sync ì ìš©, ë°˜í™˜ íƒ€ì… `WeeklyGoal[]` â†’ `WeeklyGoal` ë³€ê²½, ì¬ì¡°íšŒ ì œê±° | 4h |
| **B-2** | weeklyGoalStore.ts | Repository ë°˜í™˜ íƒ€ì… ë³€ê²½ ëŒ€ì‘, ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš© | 1.5h |
| **B-3** | inboxRepository.ts | Item Sync ì ìš©, `syncGlobalInboxToFirebase` â†’ ê°œë³„ ë™ê¸°í™” | 4h |
| **B-4** | templateRepository.ts | Firebase ë™ê¸°í™” ë¡œì§ ì¶”ê°€ (createTemplate, updateTemplate, deleteTemplate) | 3h |
| **B-5** | ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ | Firebase ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° ë³€í™˜ (Collection â†’ Items) | 3h |
| **B-6** | tests/* | ë³€ê²½ëœ Repository/Store í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ | 2h |

**ì™„ë£Œ ê¸°ì¤€**:
- WeeklyGoal CRUD ì‹œ Firebase í˜ì´ë¡œë“œ ~90% ê°ì†Œ
- GlobalInbox ë‹¨ì¼ ì‘ì—… ë™ê¸°í™” ë™ì‘
- Template Firebase ë™ê¸°í™” ì •ìƒ ë™ì‘
- ë©€í‹° ê¸°ê¸° í…ŒìŠ¤íŠ¸ í†µê³¼

**ì˜ì¡´ì„±**: Phase A ì™„ë£Œ í•„ìˆ˜

---

### Phase C (3/3) - í†µí•© ë° ë§ˆë¬´ë¦¬

> **ëª©í‘œ**: EventBus ìµœì í™”, Debounce ì ìš©, Feature Flag ë° ë¡¤ì•„ì›ƒ ì¤€ë¹„

| í•­ëª© | íŒŒì¼ | ì„¤ëª… | ì‹œê°„ |
|------|------|------|------|
| **C-1** | subscribers/*.ts | `task:completed` ë°°ì¹˜ ì²˜ë¦¬ ì˜µì…˜ ì ìš© | 3h |
| **C-2** | syncEngine/lifecycle.ts | Debounce 300ms ì ìš© | 1h |
| **C-3** | systemState (featureFlags) | Feature flag ì‹œìŠ¤í…œ êµ¬ì¶• (`ITEM_SYNC_ENABLED`, `SYNC_DEBOUNCE`) | 2h |
| **C-4** | í†µí•© í…ŒìŠ¤íŠ¸ | E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (ë©€í‹° ê¸°ê¸°, ì˜¤í”„ë¼ì¸, ì—°ì† ì‘ì—…) | 2h |
| **C-5** | ì„±ëŠ¥ ì¸¡ì • | Firebase Console/Performance.measure()ë¡œ ê°œì„  íš¨ê³¼ ì¸¡ì • | 1h |
| **C-6** | ë¬¸ì„œí™” | CHANGELOG, ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ ì‘ì„± | 1h |

**ì™„ë£Œ ê¸°ì¤€**:
- Feature flagë¡œ ë¡¤ë°± ê°€ëŠ¥
- ì„±ëŠ¥ ì§€í‘œ ì¸¡ì • ì™„ë£Œ (WeeklyGoal í˜ì´ë¡œë“œ -90%, Firebase ì“°ê¸° -50%)
- ë¬¸ì„œí™” ì™„ë£Œ

**ì˜ì¡´ì„±**: Phase B ì™„ë£Œ í•„ìˆ˜

---

## 6. ë¶„í•  ê¸°ì¤€ ê·¼ê±°

### Phase Aë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ë¦¬í•œ ì´ìœ 

1. **ë¬´ì¤‘ë‹¨ ë°°í¬**: ìƒˆ ì¸í„°í˜ì´ìŠ¤ëŠ” ê¸°ì¡´ ì½”ë“œì™€ ê³µì¡´í•˜ë¯€ë¡œ ë°°í¬ í›„ ì¦‰ì‹œ ë¡¤ë°± ë¶ˆí•„ìš”
2. **ë³‘ë ¬ ê°œë°œ ê°€ëŠ¥**: A ì™„ë£Œ í›„ B-1~B-4ë¥¼ ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥
3. **í…ŒìŠ¤íŠ¸ ìš°ì„ **: ì¸í”„ë¼ í…ŒìŠ¤íŠ¸ ë¨¼ì € í™•ë³´í•˜ì—¬ í›„ì† ì‘ì—… ì•ˆì •ì„± ë³´ì¥

### Phase Bë¥¼ í•µì‹¬ìœ¼ë¡œ ë¶„ë¦¬í•œ ì´ìœ 

1. **ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ë„ ìµœëŒ€**: Firebase ë¹„ìš© ì ˆê°ì˜ í•µì‹¬ (í˜ì´ë¡œë“œ 90% ê°ì†Œ)
2. **ë¦¬ìŠ¤í¬ ì§‘ì¤‘**: ë°ì´í„° êµ¬ì¡° ë³€ê²½ìœ¼ë¡œ ê°€ì¥ ì‹ ì¤‘í•œ ê²€ì¦ í•„ìš”
3. **ì˜ì¡´ ì²´ì¸**: Repository â†’ Store â†’ Feature ì „ì²´ ì˜í–¥

### Phase Cë¥¼ ë§ˆë¬´ë¦¬ë¡œ ë¶„ë¦¬í•œ ì´ìœ 

1. **ì„ íƒì  ìµœì í™”**: EventBus ë°°ì¹˜ëŠ” ì¦‰ê°ì  íš¨ê³¼ë³´ë‹¤ ì¥ê¸° ì•ˆì •ì„±
2. **ë¡¤ì•„ì›ƒ ì¤€ë¹„**: Feature flag ì—†ì´ ë°°í¬ ì‹œ ë¦¬ìŠ¤í¬ ì¦ê°€
3. **ì¸¡ì •/ë¬¸ì„œí™”**: ì‹¤ì œ ê°œì„  íš¨ê³¼ í™•ì¸ í›„ ì»¤ë°‹

---

## 7. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 7.1 Firebase ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

```
ê¸°ì¡´ ê²½ë¡œ: users/{uid}/weeklyGoals = [goal1, goal2, goal3]
ì‹ ê·œ ê²½ë¡œ: users/{uid}/weeklyGoals/{goalId} = goal

ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ:
1. Cloud Functionìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° ë³µì‚¬ (êµ¬ â†’ ì‹ )
2. ì•±ì—ì„œ ì‹ ê·œ ê²½ë¡œ ì½ê¸° ìš°ì„ , êµ¬ ê²½ë¡œ í´ë°±
3. ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—…ë°ì´íŠ¸ í™•ì¸ í›„ êµ¬ ê²½ë¡œ ì‚­ì œ
```

### 7.2 ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤

| ìƒí™© | ë¡¤ë°± ë°©ë²• |
|------|----------|
| Phase A ë¬¸ì œ | ìƒˆ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš© ì•ˆ í•¨ (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ) |
| Phase B ë¬¸ì œ | Feature flag OFF â†’ ê¸°ì¡´ Collection Sync í´ë°± |
| Phase C ë¬¸ì œ | Debounce/Batch flag OFF |

### 7.3 Open Questions

1. **í…œí”Œë¦¿ ë™ê¸°í™” ì¶©ëŒ ì „ëµ**: LWW vs ID-based merge?
   - **ê¶Œì¥**: LWW (í…œí”Œë¦¿ì€ ì¶©ëŒ ê°€ëŠ¥ì„± ë‚®ìŒ)

2. **Debounce ì¤‘ ì˜¤í”„ë¼ì¸ ì „í™˜ ì²˜ë¦¬**
   - **ê¶Œì¥**: ì¦‰ì‹œ flush â†’ retry queue ì¶”ê°€

3. **EventBus ë°°ì¹˜ í¬ê¸° ìµœì ê°’**
   - **ê¶Œì¥**: ì´ˆê¸°ê°’ 10, ì„±ëŠ¥ ì¸¡ì • í›„ ì¡°ì •

---

## 8. ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ**: Phase A-1 (ItemSyncStrategy ì¸í„°í˜ì´ìŠ¤) ì„¤ê³„ ë¦¬ë·° ìš”ì²­
2. **ë³‘í–‰**: Phase A-4 (í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„)
3. **Phase A ì™„ë£Œ í›„**: Phase B ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì„¤ê³„

---

| ë³€ê²½ì¼ | ë³€ê²½ì | ë‚´ìš© |
|--------|--------|------|
| 2026-01-09 | Analyst | ì´ˆì•ˆ ì‘ì„± |

