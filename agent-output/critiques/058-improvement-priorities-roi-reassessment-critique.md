---
ID: 58
Origin: 57
UUID: a7f9b3c1
Status: OPEN
---

# Critique: 전반 개선 과제 ROI 재정렬 비평

| Date | Handoff | Request | Summary |
|------|---------|---------|---------|
| 2026-01-03 | User→Critic | 전반 과제 비판적 재정렬 | Top 5-8 우선순위, Anti-goals 5개, 실패 모드/완충책 |

---

## Executive Summary

기존 분석(050, 057)과 로드맵(049)에서 제안된 ~20개 과제를 **ROI(Value/Risk/Difficulty)** 기준으로 재평가.
결론: **실행 가능한 6개 과제**로 축소하고, **5개 Anti-goals**(하지 말아야 할 것)를 명시.

### 핵심 가정과 불확실성

| 가정 | 불확실성 수준 | 영향 |
|------|--------------|------|
| CI 블로커(Lint)가 가장 급함 | 낮음 (Fact) | 다른 모든 PR을 막음 |
| ADHD 사용자가 주요 타겟 | 낮음 (명시됨) | UX 우선순위 결정 |
| Optimistic Update 롤백 복잡도 | 중간 (검증 필요) | PR8 리스크 결정 |
| 대규모 alias 통일(PR7)의 ROI | 높음 (과대평가 위험) | 삭제 후보 |
| 테스트 커버리지 임계값 합의 | 중간 (미정) | 게이트 기준 |

---

## 1. 우선순위 재정렬 (Top 6, ROI 내림차순)

### Tier 1: Must-Do (차단 해제 + 데이터 안전)

| 순위 | 과제 | ROI | 근거 |
|------|------|-----|------|
| **#1** | **Lint 오류 수정 (CI 차단 해제)** | ★★★★★ | Effort: 1-3h. 모든 PR 전제 조건. 즉시 실행. |
| **#2** | **배경 클릭 모달 닫힘 제거** | ★★★★☆ | Effort: 0.5-1h. ADHD 사용자 입력 손실 직접 방지. 정책 위반 수정. |
| **#3** | **unifiedTaskService 테스트 확대** | ★★★★☆ | Effort: 3-6h. 핵심 데이터 경로 보호. partial-failure 분기 커버. |

### Tier 2: High-Value (ADHD UX + 품질 게이트)

| 순위 | 과제 | ROI | 근거 |
|------|------|-----|------|
| **#4** | **Sync 모듈 테스트 강화 (conflictResolver + syncCore)** | ★★★☆☆ | Effort: 5-10h. 고위험 영역 안전망. 기존 flaky 테스트 안정화 병행. |
| **#5** | **Always-on-top 토글 UX 개선** | ★★★☆☆ | Effort: 2-4h. 작은 히트 영역 → 44px+ 버튼. ADHD 인지 부담 직접 감소. |
| **#6** | **시간 블록 유틸 가드 추가** | ★★☆☆☆ | Effort: 2-4h. 런타임 예외 방지. 방어적 코딩. |

### 보류/제외 항목 (아래 "Anti-goals" 참조)

| 항목 | 제외 사유 |
|------|----------|
| PR7: 대규모 alias 통일 | Anti-goal #1 |
| PR8: Optimistic Update | Anti-goal #2 (Phase 2로 이동) |
| 테스트 중복 통합 (visibility) | 낮은 ROI, Quick Win 아님 |
| AppShell 분해 | Anti-goal #3 |
| 레거시 기능 모듈화 (battle/waifu) | Anti-goal #4 |
| Sync 테스트 스프롤 통합 | Anti-goal #5 (Phase 2로 이동) |

---

## 2. Anti-goals: 하지 말아야 할 것 5가지

### Anti-goal #1: 대규모 Import Path Rename (PR7)

**겉으로 좋아 보이는 이유**: 코드베이스 일관성, 검색/이동 편의
**실제 위험**:
- 수백 파일 변경 → 모든 진행 중 브랜치와 충돌
- 코드 리뷰 불가능 (변경량 과다)
- 기능적 가치 0, 버그 가능성만 증가
- ADHD 친화와 무관

**권고**: ❌ 완전 배제. 새 파일 생성 시에만 alias 사용 규칙 적용.

---

### Anti-goal #2: Optimistic Update 조기 구현 (PR8)

**겉으로 좋아 보이는 이유**: 즉각 피드백, UX 개선
**실제 위험**:
- 롤백 로직 복잡도 높음 (상태 불일치, 유령 task)
- unifiedTaskService 테스트 없이 진행하면 regression 확정
- 현재 테스트 커버리지(~59%)로는 안전망 부족

**권고**: ⏸️ Phase 2로 이동. #3, #4 테스트 완료 후 진행. 별도 릴리즈.

---

### Anti-goal #3: AppShell 대규모 리팩토링

**겉으로 좋아 보이는 이유**: 관심사 분리, 유지보수성
**실제 위험**:
- AppShell은 대부분 JSX/props, 로직은 이미 ~7개 커스텀 훅에 분리됨
- 리팩토링 ROI 극히 낮음
- 고위험 영역 (초기화, 모달 상태, 토스트) 건드림

**권고**: ❌ 백로그로 이동. 실제 버그 발생 시에만 부분 수정.

---

### Anti-goal #4: 레거시 기능 모듈화 (battle/gamification/waifu/weather)

**겉으로 좋아 보이는 이유**: 코어 경량화, 집중
**실제 위험**:
- 제품 결정 필요 (아키텍처 결정 아님)
- 모듈 분리 작업량 2주+ 예상
- 사용자 가치 직접 영향 없음

**권고**: ❌ 제품 로드맵 결정 전까지 보류. 필요 시 lazy loading만 적용.

---

### Anti-goal #5: Sync 테스트 스프롤 "통합" (6개 파일 → 1개)

**겉으로 좋아 보이는 이유**: CI 속도, 유지보수 단순화
**실제 위험**:
- 통합 과정에서 테스트 누락/변형 위험
- 현재 sync 영역이 flaky하면 통합이 더 위험
- "정리"보다 "커버리지 확대"가 우선

**권고**: ⏸️ 커버리지 80% 달성 후 Phase 2에서 정리. 지금은 추가만.

---

## 3. 각 과제의 실패 모드와 완충책

### #1 Lint 오류 수정

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| 수정 시 다른 에러 유발 | 낮음 | 1파일씩 커밋, CI 확인 |
| eslint 설정 자체 문제 | 낮음 | `eslint-config-prettier` 충돌 점검 |

**성공 지표**: `npm run lint` 에러 0, CI 그린

---

### #2 배경 클릭 모달 닫힘 제거

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| 다른 모달에서 동일 위반 누락 | 중간 | grep `onClose` + `onClick` 패턴 전수 검색 |
| 접근성 회귀 (ESC도 막힘) | 낮음 | ESC 동작 테스트 케이스 추가 |

**성공 지표**: 모든 모달 ESC만 닫힘, 배경 클릭 무반응

---

### #3 unifiedTaskService 테스트 확대

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| Dexie 모킹 복잡도로 테스트 불안정 | 중간 | `fake-indexeddb` 사용, 트랜잭션 격리 |
| partial-failure 시나리오 누락 | 중간 | 명시적 체크리스트: dual-storage 실패, not-found, 경계 날짜 |
| 테스트 작성 중 기존 버그 발견 | 높음 (긍정적) | 버그는 별도 이슈로 분리, 테스트는 예상 동작 기준 |

**성공 지표**: 커버리지 75%+, 분기 커버리지 70%+

---

### #4 Sync 모듈 테스트 강화

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| 테스트 flaky (타이밍 의존) | 높음 | `vi.useFakeTimers()`, 결정적 시드 |
| Firebase 모킹 불완전 | 중간 | 최소 인터페이스만 모킹, 실제 호출 차단 확인 |
| 충돌 해결 엣지 케이스 누락 | 중간 | 타입별 체크리스트: timestamp tie, array merge, field missing |

**성공 지표**: 커버리지 70%+, flaky 테스트 0

---

### #5 Always-on-top 토글 UX 개선

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| 툴바 레이아웃 깨짐 | 낮음 | Storybook/스냅샷 테스트 |
| Electron IPC 변경 필요 | 낮음 | 기존 `setAlwaysOnTop` 재사용, IPC 신규 없음 |
| 사용자 혼란 (위치 변경) | 중간 | 툴팁 + 첫 실행 가이드 토스트 |

**성공 지표**: 히트 영역 44px+, 키보드 단축키 힌트 표시

---

### #6 시간 블록 유틸 가드 추가

| 실패 모드 | 확률 | 완충책 |
|----------|------|--------|
| 과도한 가드로 정상 동작 차단 | 낮음 | 기존 테스트 통과 확인 후 가드 추가 |
| 타입 가드와 런타임 가드 불일치 | 낮음 | Zod 스키마 사용 검토 |

**성공 지표**: 런타임 예외 0 (malformed 입력 시 early return)

---

## 4. 품질 지표 및 게이트 제안

### PR당 변경량 제한

| 지표 | 임계값 | 근거 |
|------|--------|------|
| 변경 파일 수 | ≤ 15개 | 리뷰 가능성, ADHD 친화 |
| 변경 라인 수 | ≤ 400줄 | GitHub 리뷰어 피로도 연구 기준 |
| 신규 파일 | ≤ 3개 | 구조 변경 최소화 |

**예외**: 순수 테스트 파일, 자동 생성 파일

---

### 테스트 커버리지 임계

| 영역 | 현재 | 목표 | 게이트 |
|------|------|------|--------|
| unifiedTaskService | ~59% | 75% | PR3 머지 조건 |
| conflictResolver | ~58% | 70% | PR4 머지 조건 |
| syncCore | ~62% | 70% | PR5 머지 조건 |
| 전체 | ~65% | 70% | 릴리즈 조건 |

---

### Performance Budget

| 지표 | 임계값 | 측정 방법 |
|------|--------|----------|
| Vitest 전체 실행 | ≤ 60초 | CI 로그 |
| 단일 테스트 파일 | ≤ 5초 | `--reporter=verbose` |
| Dexie 쿼리 (핫패스) | ≤ 50ms | 개발자 도구 Performance |

---

### Lint/Typecheck 게이트

```yaml
# CI 파이프라인 필수 단계
- npm run lint          # 에러 0
- npm run typecheck     # 에러 0
- npm run test:coverage # 임계 충족
```

---

## 5. 실행 로드맵 (Phase 1: 2주)

```
Week 1:
  Day 1-2: #1 Lint 수정 + CI 복구
  Day 2-3: #2 모달 배경 클릭 제거
  Day 3-5: #3 unifiedTaskService 테스트

Week 2:
  Day 1-3: #4 Sync 테스트 (conflictResolver + syncCore)
  Day 3-4: #5 Always-on-top UX
  Day 4-5: #6 유틸 가드 + 릴리즈 준비
```

**Phase 2 (이후)**: Optimistic Update, 테스트 정리/통합

---

## 6. ADHD-Friendly Impact 매트릭스

| 과제 | 인지부담 감소 | 실수 방지 | 즉각 피드백 | 총점 |
|------|-------------|----------|------------|------|
| #1 Lint | - | ⭐ | ⭐⭐ | 3 |
| #2 모달 | ⭐⭐⭐ | ⭐⭐⭐ | - | 6 |
| #3 테스트 | - | ⭐⭐ | - | 2 |
| #4 Sync 테스트 | - | ⭐⭐ | - | 2 |
| #5 Always-on-top | ⭐⭐ | ⭐ | ⭐ | 4 |
| #6 가드 | - | ⭐⭐ | - | 2 |

**최고 ADHD 임팩트**: #2 모달 > #5 Always-on-top

---

## 7. Critic 권고 사항

1. **지금 당장**: #1 Lint 수정으로 CI 복구
2. **이번 스프린트**: #2, #3을 묶어 "데이터 안전" 테마로 릴리즈
3. **다음 스프린트**: #4, #5, #6으로 "안정성 + UX" 테마
4. **명시적 배제**: PR7(alias), PR8(optimistic)은 Phase 2
5. **게이트 도입**: 커버리지 70% 미만 PR 머지 차단

---

## Open Questions

1. **Phase 2 시작 조건**: 커버리지 70% 달성 + flaky 테스트 0 확인 후?
2. **Optimistic Update MVP 범위**: 전체 inbox vs 특정 액션만?
3. **레거시 기능 제품 결정**: battle/waifu 유지 vs 선택적 로딩?

---

## Revision History

| Revision | Date | Changes | Status |
|----------|------|---------|--------|
| Initial | 2026-01-03 | 초안 작성 (057, 050, 049 기반 재정렬) | OPEN |
