# íƒ€ì„ë¸”ëŸ­ í”Œë˜ë„ˆ (Daily Quest) - ìµœì¢… í”„ë¡œì íŠ¸ ë³´ê³ ì„œ

> ë³¸ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œìš´ ê¸°ìˆ  ìŠ¤íƒìœ¼ë¡œ ì¬êµ¬í˜„í•  ë•Œ ì°¸ê³ í•  ìˆ˜ ìˆë„ë¡, í˜„ì¬ êµ¬í˜„ëœ ëª¨ë“  ê¸°ëŠ¥ê³¼ UI, ë°ì´í„° êµ¬ì¡°ë¥¼ ìƒì„¸íˆ ê¸°ë¡í•œ ì„¤ê³„ ë¬¸ì„œì…ë‹ˆë‹¤.

**ì‘ì„±ì¼**: 2025-11-14
**ëª©ì **: ì™„ì „í•œ ì¬êµ¬í˜„ì„ ìœ„í•œ ê¸°ëŠ¥/UI/ë°ì´í„° ëª…ì„¸ì„œ

---

## ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [ë¹Œë“œ & ì—”íŠ¸ë¦¬ êµ¬ì¡°](#2-ë¹Œë“œ--ì—”íŠ¸ë¦¬-êµ¬ì¡°)
3. [í™”ë©´ & UI êµ¬ì¡°](#3-í™”ë©´--ui-êµ¬ì¡°)
4. [ë°ì´í„° ëª¨ë¸ & ì €ì¥ êµ¬ì¡°](#4-ë°ì´í„°-ëª¨ë¸--ì €ì¥-êµ¬ì¡°)
5. [ìƒíƒœ ê´€ë¦¬ & íë¦„](#5-ìƒíƒœ-ê´€ë¦¬--íë¦„)
6. [Gemini ì—°ë™](#6-gemini-ì—°ë™)
7. [í˜„ì¬ ë°œê²¬ëœ ë¬¸ì œ & ê¸°ìˆ  ë¶€ì±„](#7-í˜„ì¬-ë°œê²¬ëœ-ë¬¸ì œ--ê¸°ìˆ -ë¶€ì±„)

---

## 1. ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ í•œ ì¤„ ìš”ì•½

**íƒ€ì„ë¸”ëŸ­ í”Œë˜ë„ˆ (Daily Quest)**: í•˜ë£¨ë¥¼ 6ê°œ ì‹œê°„ ë¸”ë¡ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ëŠ” ì¼ì • ê´€ë¦¬ ë„êµ¬ + ê²Œì„í™” ì‹œìŠ¤í…œ(XP, ë ˆë²¨) + AI ìºë¦­í„°(ì™€ì´í‘¸) ìƒí˜¸ì‘ìš© + ì—ë„ˆì§€ íŠ¸ë˜í‚¹ì„ ê²°í•©í•œ ìƒì‚°ì„± ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜

### 1.2 í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½

- **íƒ€ì„ë¸”ë¡ ìŠ¤ì¼€ì¤„ëŸ¬**: í•˜ë£¨ë¥¼ 05:00-08:00, 08:00-11:00, 11:00-14:00, 14:00-17:00, 17:00-19:00, 19:00-24:00 ì´ 6ê°œ ë¸”ë¡ìœ¼ë¡œ ë¶„í• 
- **í•  ì¼ ê´€ë¦¬**: ê° ë¸”ë¡ì— ì‘ì—… í• ë‹¹, ì˜ˆìƒ ì‹œê°„/ì‹¤ì œ ì‹œê°„/ì‹¬ë¦¬ì  ê±°ë¶€ê°(ì €í•­ë„) ê¸°ë¡
- **ê²Œì„í™”**: ì‘ì—… ì™„ë£Œ ì‹œ XP íšë“, ë ˆë²¨ì—…, ì¼ì¼ í€˜ìŠ¤íŠ¸, ë¸”ë¡ ì™„ë²½ ì™„ë£Œ ë³´ë„ˆìŠ¤
- **AI ì™€ì´í‘¸ ì±—ë´‡**: í˜¸ê°ë„(0-100) ê¸°ë°˜ ì„±ê²© ë³€í™”, Gemini API ì—°ë™ ëŒ€í™”, ìë™ ë©”ì‹œì§€
- **ì—ë„ˆì§€ ê´€ë¦¬**: ì‹œê°„ëŒ€ë³„ ì—ë„ˆì§€ ìˆ˜ì¤€(0-100) ê¸°ë¡ ë° í†µê³„
- **í…œí”Œë¦¿ ì‹œìŠ¤í…œ**: ë°˜ë³µ ì‘ì—… ìë™ ìƒì„±
- **ìƒì  ì‹œìŠ¤í…œ**: XPë¡œ ë³´ìƒ êµ¬ë§¤
- **í†µê³„ & íˆìŠ¤í† ë¦¬**: 5ì¼ XP ì°¨íŠ¸, ì‹œê°„ëŒ€ë³„ XP, ì™„ë£Œ ì‘ì—… íˆìŠ¤í† ë¦¬

### 1.3 í˜„ì¬ ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|------|------|
| **í”„ë¡ íŠ¸ì—”ë“œ** | ìˆœìˆ˜ HTML5 / CSS3 / JavaScript (ES6+) |
| **ë¹Œë“œ ë„êµ¬** | ì—†ìŒ (No build step) |
| **ëª¨ë“ˆ ì‹œìŠ¤í…œ** | `window` ê°ì²´ì— ë…¸ì¶œí•˜ëŠ” ë°©ì‹ |
| **ì €ì¥ì†Œ** | 3ë‹¨ê³„: IndexedDB (1ìˆœìœ„) â†’ localStorage (2ìˆœìœ„) â†’ Firebase Realtime DB (3ìˆœìœ„) |
| **í´ë¼ìš°ë“œ ë™ê¸°í™”** | Firebase SDK 10.7.1 (app-compat, database-compat) |
| **AI ì—°ë™** | Google Gemini 2.5 Flash API (HTTPS REST) |
| **ë§ˆí¬ë‹¤ìš´ íŒŒì‹±** | Marked.js 11.1.1 (AI ì‘ë‹µ ë Œë”ë§ìš©) |
| **íƒ€ì´ë¨¸ ê´€ë¦¬** | ì»¤ìŠ¤í…€ `TimerManager` (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€) |
| **CDN ì˜ì¡´ì„±** | Firebase SDK, Marked.js |

**íŠ¹ì§•**:
- **ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ ì—†ìŒ**: íŒŒì¼ì„ ìˆ˜ì •í•˜ë©´ ì¦‰ì‹œ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸ ê°€ëŠ¥
- **ìˆœìˆ˜ JavaScript**: TypeScript, Webpack, Vite ë“± ë¹Œë“œ ë„êµ¬ ë¯¸ì‚¬ìš©
- **ëª¨ë“ˆí™”**: ê° ê¸°ëŠ¥ë³„ë¡œ ëª¨ë“ˆ íŒŒì¼ ë¶„ë¦¬ (js/modules/*.js)
- **í•˜ìœ„ í˜¸í™˜ì„±**: ëª¨ë“  í•¨ìˆ˜ë¥¼ `window` ê°ì²´ì— ì¤‘ë³µ ë…¸ì¶œí•˜ì—¬ ê¸°ì¡´ ì½”ë“œ í˜¸í™˜

---

## 2. ë¹Œë“œ & ì—”íŠ¸ë¦¬ êµ¬ì¡°

### 2.1 ì§„ì…ì  ë° ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìˆœì„œ

**ì—”íŠ¸ë¦¬ íŒŒì¼**: `index.html` (ë¼ì¸ 349-402)

**ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìˆœì„œ** (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ):

```html
<!-- 1. ì™¸ë¶€ CDN ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

<!-- 2. ì„¤ì • íŒŒì¼ -->
<script src="config.js"></script>

<!-- 3. ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ (ê°€ì¥ ë¨¼ì € ë¡œë“œ) -->
<script src="js/modules/constants.js"></script>
<script src="js/modules/dom-utils.js"></script>
<script src="js/modules/performance-utils.js"></script>
<script src="js/modules/indexed-db-cache.js"></script>

<!-- 4. Gemini AI ìŠ¤íƒ (ì˜ì¡´ì„± ìˆœì„œ ì¤‘ìš”) -->
<script src="js/modules/gemini-utils.js"></script>
<script src="js/modules/gemini-persona-builder.js"></script>
<script src="js/modules/gemini-api.js"></script>
<script src="js/modules/gemini-storage.js"></script>
<script src="js/modules/gemini-chat-ui.js"></script>
<script src="js/modules/gemini-message-box.js"></script>

<!-- 5. ìƒíƒœ & ì—ë„ˆì§€ -->
<script src="js/modules/energy-manager.js"></script>
<script src="js/modules/state-manager.js"></script>

<!-- 6. Firebase ë™ê¸°í™” -->
<script src="js/modules/firebase-sync.js"></script>

<!-- 7. ë°ì´í„° & ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ -->
<script src="js/modules/storage.js"></script>
<script src="js/modules/block-manager.js"></script>
<script src="js/modules/render-engine.js"></script>
<script src="js/modules/task-manager.js"></script>
<script src="js/modules/task-completion.js"></script>

<!-- 8. ê¸°ëŠ¥ ëª¨ë“ˆ -->
<script src="js/modules/scheduler.js"></script>
<script src="js/modules/drag-drop-handler.js"></script>
<script src="js/modules/modal-handlers.js"></script>
<script src="js/modules/statistics.js"></script>
<script src="js/modules/gamification-system.js"></script>
<script src="js/modules/template-manager.js"></script>
<script src="js/modules/shop-manager.js"></script>

<!-- 9. UI & ì´ë²¤íŠ¸ -->
<script src="js/modules/event-handlers.js"></script>
<script src="js/modules/ui-updates.js"></script>

<!-- 10. íƒ€ì´ë¨¸ ê´€ë¦¬ -->
<script src="js/timerManager.js"></script>

<!-- 11. ì™€ì´í‘¸ ì‹œìŠ¤í…œ -->
<script src="js/waifu.js"></script>

<!-- 12. ì•± ìƒëª…ì£¼ê¸° (ì´ˆê¸°í™” ë¡œì§ í¬í•¨) -->
<script src="js/modules/app-lifecycle.js"></script>

<!-- 13. ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (ë°ì´í„° ë™ê¸°í™” ë˜í¼) -->
<script src="js/all-in-one.js"></script>
```

### 2.2 ì´ˆê¸°í™” íë¦„

**`app-lifecycle.js`ì˜ `init()` í•¨ìˆ˜ê°€ ìë™ ì‹¤í–‰ë¨** (ë¼ì¸ 537-538):

```javascript
// app-lifecycle.js ë§ˆì§€ë§‰ ë¼ì¸
init();
```

**ì´ˆê¸°í™” ë‹¨ê³„**:

1. **íƒ€ì´ë¨¸ ì •ë¦¬**: ê¸°ì¡´ íƒ€ì´ë¨¸ ëª¨ë‘ ì œê±° (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
2. **IndexedDB ì´ˆê¸°í™”**: ëŒ€ìš©ëŸ‰ ë¹„ë™ê¸° ìºì‹± ë ˆì´ì–´ ì¤€ë¹„
3. **DOM ìºì‹±**: ìì£¼ ì‚¬ìš©í•˜ëŠ” DOM ìš”ì†Œë¥¼ `window.DOM` ê°ì²´ì— ì €ì¥
4. **Firebase ì´ˆê¸°í™”**:
   - `config.js`ì—ì„œ `firebaseConfig` ì½ê¸°
   - API key ê²€ì¦ â†’ ì´ˆê¸°í™” ì„±ê³µ/ì‹¤íŒ¨ ë¶„ê¸°
   - ì„±ê³µ ì‹œ `window.db` ì„¤ì •, ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ëª¨ë“œ
5. **ë°ì´í„° ë¡œë“œ**:
   - **í…œí”Œë¦¿/ìƒì  ë¡œë“œ** (`loadTemplatesAndShop()`)
   - **ë¡œì»¬ ë°ì´í„° ë¡œë“œ** (`loadLocalData()` - localStorage)
   - **Firebase ëª¨ë“œì¼ ê²½ìš°**:
     - `loadGameState()` - ê²Œì„ ìƒíƒœ ë¡œë“œ
     - ë‚ ì§œ ë³€ê²½ ê°ì§€ â†’ `initializeNewDay()` í˜¸ì¶œ
     - `setupRealtimeSync()` - Firebase ì‹¤ì‹œê°„ ë™ê¸°í™” ì„¤ì •
6. **ì´ˆê¸° ë Œë”ë§**:
   - `renderAll()` - ì „ì²´ UI ë Œë”ë§
   - `updateXPBar()` - XP ë°” ì—…ë°ì´íŠ¸
   - `renderXPHistory()` - XP íˆìŠ¤í† ë¦¬ ì°¨íŠ¸
7. **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •**: `setupEventListeners()`
8. **íƒ€ì´ë¨¸ ì‹œì‘**:
   - 1ì´ˆë§ˆë‹¤: `updateCurrentTime()`, `moveExpiredTasks()`
   - 10ë¶„ë§ˆë‹¤: `collapseAllExceptCurrent()` (ë¹„í˜„ì¬ ë¸”ë¡ ìë™ ì ‘ê¸°)
   - 15ë¶„ë§ˆë‹¤: `autoFocusCurrentBlock()` (í˜„ì¬ ë¸”ë¡ ìë™ í¬ì»¤ìŠ¤)
9. **ì„œë¸Œì‹œìŠ¤í…œ ì´ˆê¸°í™”**:
   - `initWaifuSystem()` - ì™€ì´í‘¸ ì´ˆê¸°í™”
   - `WaifuMessageBox.init()` - ìë™ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
   - `EnergyManager.init()` - ì—ë„ˆì§€ ê´€ë¦¬ UI
   - `Scheduler.init()` - ìŠ¤ì¼€ì¤„ëŸ¬ ê·¸ë¦¬ë“œ

### 2.3 ëª¨ë“ˆ ì‹œìŠ¤í…œ êµ¬ì¡°

**íŒ¨í„´**: ê° ëª¨ë“ˆì€ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  `window` ê°ì²´ì— ë…¸ì¶œ

```javascript
// ì˜ˆì‹œ: task-manager.js
const openAddModal = (blockId) => { /* ... */ };
const closeAddModal = () => { /* ... */ };

// window ê°ì²´ì— ë…¸ì¶œ (ë„¤ì„ìŠ¤í˜ì´ìŠ¤ + ê°œë³„ í•¨ìˆ˜)
window.TaskManager = { openAddModal, closeAddModal };
window.openAddModal = openAddModal; // í•˜ìœ„ í˜¸í™˜ì„±
window.closeAddModal = closeAddModal;
```

**ì¥ì **:
- ë¹Œë“œ ë„êµ¬ ì—†ì´ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥
- HTMLì—ì„œ `onclick="openAddModal()"` ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥

**ë‹¨ì **:
- ì „ì—­ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì˜¤ì—¼
- ì˜ì¡´ì„± ê´€ë¦¬ê°€ ë¡œë”© ìˆœì„œì— ì˜ì¡´
- íƒ€ì… ì•ˆì •ì„± ì—†ìŒ

---

## 3. í™”ë©´ & UI êµ¬ì¡°

### 3.1 ì „ì²´ ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Top Toolbar                                                â”‚
â”‚  [âš¡ ì—ë„ˆì§€] [ğŸ’ ì˜¤ëŠ˜XP] [ğŸ† ë³´ìœ XP] [âš¡ì…ë ¥] [ğŸ’¬AIëŒ€í™”] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚ Active Task Banner           â”‚                    â”‚
â”‚  Left  â”‚ [ì§„í–‰ ì¤‘ì¸ ì‘ì—… ì •ë³´]        â”‚                    â”‚
â”‚ Sidebarâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Waifu Panel     â”‚
â”‚        â”‚ Current Block Visualizer     â”‚                    â”‚
â”‚ [íƒ­ë“¤] â”‚ [í˜„ì¬ ë¸”ë¡ ì§„í–‰ë„/ì™„ë£Œìœ¨]    â”‚ [ìºë¦­í„° ì´ë¯¸ì§€]    â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ [ë©”ì‹œì§€]           â”‚
â”‚ ì˜¤ëŠ˜   â”‚                              â”‚ [ì¹œë°€ë„/ì™„ë£Œ/ê¸°ë¶„] â”‚
â”‚ í†µê³„   â”‚   Timeline Section           â”‚                    â”‚
â”‚ ì—ë„ˆì§€ â”‚   (6ê°œ Time Blocks)          â”‚                    â”‚
â”‚ ì™„ë£Œ   â”‚                              â”‚                    â”‚
â”‚ ì¸ë°•ìŠ¤ â”‚   [05-08] [08-11] [11-14]    â”‚                    â”‚
â”‚        â”‚   [14-17] [17-19] [19-24]    â”‚                    â”‚
â”‚        â”‚                              â”‚                    â”‚
â”‚        â”‚   ê° ë¸”ë¡ ë‚´ë¶€:               â”‚   Right Panel     â”‚
â”‚        â”‚   - ë¸”ë¡ í—¤ë”                 â”‚                    â”‚
â”‚        â”‚   - ì‘ì—… ëª©ë¡                 â”‚   [ğŸ“ í…œí”Œë¦¿]      â”‚
â”‚        â”‚   - ì¶”ê°€ ë²„íŠ¼                 â”‚   [ğŸ›’ ìƒì ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì£¼ìš” UI ì˜ì—­

#### 3.2.1 Top Toolbar

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 18-42

**êµ¬ì„± ìš”ì†Œ**:
- **ì—ë„ˆì§€ ë””ìŠ¤í”Œë ˆì´**: `#energyDisplay` - ìµœê·¼ ê¸°ë¡ëœ ì—ë„ˆì§€ ìˆ˜ì¤€ í‘œì‹œ
- **ì˜¤ëŠ˜ XP**: `#todayXPDisplay` - ì˜¤ëŠ˜ íšë“í•œ XP (dailyXP)
- **ë³´ìœ  XP**: `#availableXPDisplay` - ì‚¬ìš© ê°€ëŠ¥í•œ ì´ XP (availableXP)
- **ì—ë„ˆì§€ ì…ë ¥ ë²„íŠ¼**: `openEnergyInput()` í˜¸ì¶œ, ë‹¨ì¶•í‚¤ Ctrl+O
- **AI ëŒ€í™” ë²„íŠ¼**: `openWaifuChat()` í˜¸ì¶œ

#### 3.2.2 Active Task Banner

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 61-77

**í‘œì‹œ ì¡°ê±´**: ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ (`window.activeTaskId !== null`)

**ì •ë³´**:
- ì‘ì—… ì œëª© (`#activeTaskTitle`)
- ê²½ê³¼ ì‹œê°„ (`#activeTaskTime`) - 00:00 í˜•ì‹
- íšë“ XP (`#activeTaskXP`) - ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- ë³´ë„ˆìŠ¤ ì •ë³´ (`#activeTaskBonus`)

**ë™ì‘**:
- ì‘ì—… ì‹œì‘ ì‹œ ìë™ í‘œì‹œ
- 1ì´ˆë§ˆë‹¤ ê²½ê³¼ ì‹œê°„ ì—…ë°ì´íŠ¸
- ì‘ì—… ì™„ë£Œ ì‹œ ìˆ¨ê¹€

#### 3.2.3 Current Block Visualizer

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 44-58

**í‘œì‹œ ì¡°ê±´**: í˜„ì¬ ì‹œê°„ì´ ë¸”ë¡ ì‹œê°„ëŒ€ì— ì†í•  ë•Œ

**ì •ë³´**:
- ë¸”ë¡ ì‹œê°„ëŒ€ ë¼ë²¨ (ì˜ˆ: "08:00-11:00")
- ì‹œê°„ ì§„í–‰ë¥  ë°” (`#currentBlockTimeFill`)
- ê²½ê³¼/ì „ì²´ ì‹œê°„ (ì˜ˆ: "45/180ë¶„")
- ì‘ì—… ì™„ë£Œìœ¨ ë°” (`#blockCompletionFill`)
- ì™„ë£Œ/ì „ì²´ ì‘ì—… ì‹œê°„

**ê³„ì‚° ë¡œì§** (`ui-updates.js`):
- í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë¸”ë¡ ì§„í–‰ë¥  ê³„ì‚°
- ì™„ë£Œëœ ì‘ì—…ì˜ adjustedDuration í•©ì‚°í•˜ì—¬ ì™„ë£Œìœ¨ ê³„ì‚°

#### 3.2.4 Left Sidebar (íƒ­ ì‹œìŠ¤í…œ)

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 79-154

**íƒ­ ëª©ë¡**:

##### (1) ğŸ¯ ì˜¤ëŠ˜ íƒ­

**ë‚´ìš©**: ì¼ì • ìŠ¤ì¼€ì¤„ëŸ¬ ê·¸ë¦¬ë“œ

**í‘œì‹œ**:
- ìŠ¤ì¼€ì¤„ ë¸”ë¡ë“¤ì˜ ê·¸ë¦¬ë“œ ë·° (Scheduler.jsê°€ ë Œë”ë§)
- ê° ì‹œê°„ëŒ€ë³„ ìŠ¤ì¼€ì¤„ í•­ëª©
- ìƒ‰ìƒë³„ ì‹œê°í™”

**ê¸°ëŠ¥**:
- ìŠ¤ì¼€ì¤„ ì¶”ê°€/í¸ì§‘/ì‚­ì œ
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ì‹œê°„ ì¡°ì •

##### (2) ğŸ“Š í†µê³„ íƒ­

**ë‚´ìš©**:
- **ì§€ë‚œ 5ì¼ XP ì°¨íŠ¸** (`#xpChart`): ë§‰ëŒ€ ê·¸ë˜í”„
- **ì˜¤ëŠ˜ ì‹œê°„ëŒ€ë³„ XP** (`#timeblockXpChart`): ë¸”ë¡ë³„ XP ë§‰ëŒ€

**ë°ì´í„° ì†ŒìŠ¤**:
- `window.xpHistory` - ìµœê·¼ 7ì¼ XP ê¸°ë¡
- `window.timeBlockXP` - ì˜¤ëŠ˜ ê° ë¸”ë¡ì˜ XP

**ë Œë”ë§**: `statistics.js`ì˜ `renderXPHistory()`, `renderTimeblockXPChart()`

##### (3) âš¡ ì—ë„ˆì§€ íƒ­

**ë‚´ìš©**:
- **í˜„ì¬ ì—ë„ˆì§€**: ê°€ì¥ ìµœê·¼ ê¸°ë¡ (`#currentEnergy`)
- **ì˜¤ëŠ˜ í‰ê· **: ì˜¤ëŠ˜ ê¸°ë¡ëœ ì—ë„ˆì§€ í‰ê·  (`#todayAvgEnergy`)
- **ì „ì²´ í‰ê· **: ëª¨ë“  ê¸°ë¡ì˜ í‰ê·  (`#overallAvgEnergy`)
- **ì˜¤ëŠ˜ ê¸°ë¡ëœ ì—ë„ˆì§€** (`#todayEnergyList`): ì‹œê°„ë³„ ì—ë„ˆì§€ ë¦¬ìŠ¤íŠ¸
- **ì‹œê°„ëŒ€ë³„ í‰ê·  ì—ë„ˆì§€** (`#timeblockEnergyAvg`): ë¸”ë¡ë³„ í‰ê· 

**ë°ì´í„° ì†ŒìŠ¤**:
- localStorageì˜ `energyLevels_YYYY-MM-DD` í‚¤
- ê° ë ˆì½”ë“œ: `{timestamp, hour, energy, context, activity}`

**ë Œë”ë§**: `energy-manager.js`

##### (4) âœ… ì™„ë£Œ íƒ­

**ë‚´ìš©**: ì˜¤ëŠ˜ ì™„ë£Œí•œ ì‘ì—… ëª©ë¡ (`#tadaList`)

**í‘œì‹œ**:
- ì™„ë£Œ ì‹œê°„ ìˆœ ì •ë ¬
- ì‘ì—…ëª…, ì‹¤ì œ ì†Œìš” ì‹œê°„, íšë“ XP í‘œì‹œ

**ë°ì´í„° ì†ŒìŠ¤**:
- `window.tasks.filter(t => t.completed)`

##### (5) ğŸ“¥ ì¸ë°•ìŠ¤ íƒ­

**ë‚´ìš©**: ì‹œê°„ëŒ€ì— ë°°ì¹˜ë˜ì§€ ì•Šì€ ì‘ì—… (`#unassignedList`)

**ì¡°ê±´**: `task.timeBlock === null || task.timeBlock === ""`

**ê¸°ëŠ¥**:
- ë“œë˜ê·¸í•˜ì—¬ ë¸”ë¡ì— ë°°ì¹˜ ê°€ëŠ¥
- ì§ì ‘ í¸ì§‘/ì‚­ì œ ê°€ëŠ¥

#### 3.2.5 Timeline Section (ë©”ì¸ ì˜ì—­)

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 156-167, `render-engine.js`ì—ì„œ ë™ì  ìƒì„±

**êµ¬ì„±**:

##### Time Blocks (6ê°œ)

ê° ë¸”ë¡ì˜ êµ¬ì¡°:

```html
<div class="time-block" data-block-id="8-11">
  <div class="block-header">
    <div class="block-title">
      <span class="block-time">08:00 - 11:00</span>
      <span class="collapse-toggle">â–²</span>
    </div>
    <div class="block-controls">
      <button class="block-lock-btn">ğŸ”“</button> <!-- ë˜ëŠ” ğŸ”’ -->
      <span class="block-xp">+0 XP</span>
      <span class="task-count-badge">3ê°œ</span>
    </div>
    <!-- ìƒíƒœ ë°°ì§€: âœ¨ ì™„ë²½í•œ ê³„íš! ë˜ëŠ” âŒ ê³„íš ì‹¤íŒ¨ -->
  </div>
  <div class="block-content">
    <div class="task-list" id="taskList-8-11">
      <!-- ì‘ì—… í•­ëª©ë“¤ -->
    </div>
    <button class="add-task-btn">â• í•  ì¼ ì¶”ê°€</button>
  </div>
</div>
```

**ë¸”ë¡ ìƒíƒœ**:
- **ì¼ë°˜**: ê¸°ë³¸ ìƒíƒœ
- **ì ê¸ˆ (ğŸ”’)**: `isBlockLocked(blockId) === true`, 15 XP ì†Œëª¨
- **ì™„ë²½ (âœ¨)**: ë¸”ë¡ ì ê¸ˆ + ëª¨ë“  ì‘ì—… ì™„ë£Œ, 40 XP ë³´ìƒ
- **ì‹¤íŒ¨ (âŒ)**: ë¸”ë¡ ì ê¸ˆ + ë¯¸ì™„ë£Œ ì‘ì—… ì¡´ì¬

**ë¸”ë¡ ì ê¸ˆ ë¡œì§** (`block-manager.js`):
- ì ê¸ˆ ì‹œ: `timeBlockStates[blockId].isLocked = true`, availableXP -= 15
- í•´ì œ ì‹œ: `timeBlockStates[blockId].isLocked = false`, availableXP += 40 (í˜ë„í‹°)
- ì™„ë²½ ì™„ë£Œ ì²´í¬: ë¸”ë¡ ë‚´ ëª¨ë“  ì‘ì—…ì˜ `completed === true`

##### Task Item (ì‘ì—… í•­ëª©)

```html
<div class="task-item" data-task-id="..." draggable="true">
  <div class="task-main">
    <button class="task-checkbox">â¬œ</button> <!-- ë˜ëŠ” âœ… -->
    <div class="task-details">
      <div class="task-text">ì‘ì—… ì œëª©</div>
      <div class="task-meta">
        <span class="resistance-badge low">ğŸŸ¢ ì‰¬ì›€</span>
        <span class="duration-badge">â±ï¸ 30ë¶„</span>
      </div>
    </div>
    <div class="task-actions">
      <button class="task-action-btn start-btn">â–¶ï¸</button>
      <button class="task-action-btn edit-btn">âœï¸</button>
      <button class="task-action-btn delete-btn">ğŸ—‘ï¸</button>
    </div>
  </div>
  <!-- ë©”ëª¨ê°€ ìˆìœ¼ë©´ í‘œì‹œ -->
  <div class="task-memo">ë©”ëª¨ ë‚´ìš©...</div>
</div>
```

**ì‘ì—… ë™ì‘**:
- **ì²´í¬ë°•ìŠ¤ í´ë¦­**: `toggleTaskCompletion(taskId)` â†’ ì™„ë£Œ/ë¯¸ì™„ë£Œ í† ê¸€
  - ì™„ë£Œ ì‹œ: XP íšë“, í˜¸ê°ë„ ì¦ê°€, ì™„ë²½ ë¸”ë¡ ì²´í¬
- **â–¶ï¸ ì‹œì‘**: `startTask(taskId)` â†’ activeTaskId ì„¤ì •, íƒ€ì´ë¨¸ ì‹œì‘
- **âœï¸ í¸ì§‘**: `openEditModal(taskId)` â†’ í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
- **ğŸ—‘ï¸ ì‚­ì œ**: `deleteTask(taskId)` â†’ ì‘ì—… ì‚­ì œ

**ë“œë˜ê·¸ ì•¤ ë“œë¡­** (`drag-drop-handler.js`):
- ì‘ì—…ì„ ë‹¤ë¥¸ ë¸”ë¡ìœ¼ë¡œ ë“œë˜ê·¸ ê°€ëŠ¥
- ì¸ë°•ìŠ¤ â†” ë¸”ë¡ ê°„ ì´ë™ ê°€ëŠ¥
- ë“œë¡­ ì‹œ `task.timeBlock` ê°’ ë³€ê²½

##### Current Time Line

**í‘œì‹œ**: í˜„ì¬ ì‹œê°„ì— í•´ë‹¹í•˜ëŠ” ë¸”ë¡ì— ë¹¨ê°„ ì„  í‘œì‹œ

**ê³„ì‚°** (`ui-updates.js`):
- í˜„ì¬ ë¸”ë¡ ì°¾ê¸°
- ë¸”ë¡ ë‚´ ê²½ê³¼ ì‹œê°„ ë¹„ìœ¨ ê³„ì‚°
- `top` ìœ„ì¹˜ ì„¤ì •

#### 3.2.6 Waifu Panel

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 169-195

**êµ¬ì„±**:
- **ìºë¦­í„° ì´ë¯¸ì§€** (`#waifuImage`): í˜¸ê°ë„ì— ë”°ë¼ ë³€ê²½
- **ê¸°ë¶„ ì´ëª¨ì§€** (`#waifuMood`): ğŸ˜¡, ğŸ˜ , ğŸ˜, ğŸ™‚, ğŸ˜Š, ğŸ¥°
- **ë©”ì‹œì§€** (`#waifuMessage`): ìë™ ë©”ì‹œì§€ ë˜ëŠ” ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‘ë‹µ
- **í†µê³„**:
  - ğŸ’• ì¹œë°€ë„ (`#waifuAffection`): 0-100
  - âœ… ì™„ë£Œ (`#waifuCompletedTasks`): ì˜¤ëŠ˜ ì™„ë£Œ ì‘ì—… ìˆ˜
  - ğŸ˜Š ê¸°ë¶„ (`#waifuMoodText`): í˜¸ê°ë„ êµ¬ê°„ë³„ í…ìŠ¤íŠ¸

**í˜¸ê°ë„ êµ¬ê°„ë³„ ì´ë¯¸ì§€** (`waifu.js`):
- 0-20: annoyed, disgusted, angry, disappointed, depressed
- 20-40: suspicious, thinking, serious, bored
- 40-55: neutral, nervous
- 55-70: giggling, smiling
- 70-85: giggling, laughing, blushing shyly, happy, excited
- 85-100: admiring, joyful, winking

**ì´ë¯¸ì§€ ê²½ë¡œ**: `assets/waifu_image/hyeeun_{pose}.png`

**í˜¸ê°ë„ ì¦ê°€ ì¡°ê±´**:
- ì‘ì—… ì™„ë£Œ: +2 affection

**í˜¸ê°ë„ ê°ì†Œ ì¡°ê±´**:
- (í˜„ì¬ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŒ, ì ì¬ì ìœ¼ë¡œ ìœ íœ´ ì‹œê°„ì— ê°ì†Œ ê°€ëŠ¥)

**ìë™ ë©”ì‹œì§€** (`gemini-message-box.js`):
- ì„¤ì •ëœ ê°„ê²©(ê¸°ë³¸ 3ë¶„)ë§ˆë‹¤ ìë™ ìƒì„±
- Gemini APIë¡œ í˜„ì¬ ìƒí™© ë¶„ì„í•˜ì—¬ ë©”ì‹œì§€ ìƒì„±
- ì¼ì‹œì •ì§€ ê°€ëŠ¥

#### 3.2.7 Right Panel (í…œí”Œë¦¿ & ìƒì )

**ìœ„ì¹˜**: `index.html` ë¼ì¸ 197-227

##### ğŸ“ í…œí”Œë¦¿ íƒ­

**ë‚´ìš©**: í…œí”Œë¦¿ ëª©ë¡ (`#templateList`)

**í…œí”Œë¦¿ êµ¬ì¡°**:
```javascript
{
  id: "template-{timestamp}",
  name: "í…œí”Œë¦¿ ì´ë¦„",
  text: "ì‘ì—… ë‚´ìš©",
  memo: "ë©”ëª¨",
  baseDuration: 30,
  resistance: "low" | "medium" | "high",
  timeBlock: "8-11" | null,
  autoGenerate: true | false // ë§¤ì¼ ìë™ ìƒì„± ì—¬ë¶€
}
```

**ê¸°ëŠ¥**:
- **í…œí”Œë¦¿ ì¶”ê°€**: `openTemplateAddModal()` â†’ í…œí”Œë¦¿ ìƒì„±
- **í…œí”Œë¦¿ í¸ì§‘**: í…œí”Œë¦¿ í´ë¦­ â†’ `openTemplateEditModal(id)`
- **í…œí”Œë¦¿ ì‚­ì œ**: ì‚­ì œ ë²„íŠ¼
- **ì‘ì—… ìƒì„±**: "ì˜¤ëŠ˜ ì¶”ê°€" ë²„íŠ¼ â†’ í…œí”Œë¦¿ì—ì„œ ì‘ì—… ìƒì„±
- **ìë™ ìƒì„±**: `autoGenerate: true`ì¸ ê²½ìš° ë§¤ì¼ 00ì‹œ ìë™ ìƒì„± (`app-lifecycle.js`)

##### ğŸ›’ ìƒì  íƒ­

**ë‚´ìš©**: ìƒì  ì•„ì´í…œ ëª©ë¡ (`#shopItemList`)

**ì•„ì´í…œ êµ¬ì¡°**:
```javascript
{
  id: "shop-{timestamp}",
  name: "ìƒí’ˆ ì´ë¦„",
  price: 100, // í•„ìš” XP
  image: "data:image/..." // Base64 ì¸ì½”ë”© ì´ë¯¸ì§€ (ì„ íƒ)
}
```

**ê¸°ëŠ¥**:
- **ìƒí’ˆ ì¶”ê°€**: `openShopAddModal()` â†’ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê°€ëŠ¥
- **ìƒí’ˆ êµ¬ë§¤**: "êµ¬ë§¤" ë²„íŠ¼ â†’ availableXP ì†Œëª¨
  - ì¡°ê±´: `availableXP >= item.price`
  - íš¨ê³¼: í˜¸ê°ë„ +10, ì™€ì´í‘¸ ë©”ì‹œì§€ í‘œì‹œ

### 3.3 ëª¨ë‹¬ (Modal) ì‹œìŠ¤í…œ

#### 3.3.1 í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ (`#addModal`)

**íŠ¸ë¦¬ê±°**:
- ë¸”ë¡ ë‚´ "â• í•  ì¼ ì¶”ê°€" ë²„íŠ¼
- ë‹¨ì¶•í‚¤ (êµ¬í˜„ ì‹œ Ctrl+N ë“± ê°€ëŠ¥)

**ì…ë ¥ í•„ë“œ**:
- í•  ì¼ (`#addTaskInputModal`): í•„ìˆ˜, í…ìŠ¤íŠ¸
- ë©”ëª¨ (`#addTaskMemoModal`): ì„ íƒ, í…ìŠ¤íŠ¸
- ì˜ˆìƒ ì†Œìš”ì‹œê°„ (`#addDurationSelector`): 5, 10, 15, 30, 45, 60, 90, 120ë¶„
- ì‹¬ë¦¬ì  ê±°ë¶€ê° (`#addResistanceSelector`):
  - ğŸŸ¢ ì‰¬ì›€ (low, 1.0x)
  - ğŸŸ¡ ë³´í†µ (medium, 1.3x)
  - ğŸ”´ ì–´ë ¤ì›€ (high, 1.6x)

**ë™ì‘**:
- ì €ì¥ â†’ `addTaskFromModal()` í˜¸ì¶œ
- `adjustedDuration = baseDuration * RESISTANCE_MULTIPLIERS[resistance]` ê³„ì‚°
- `tasks` ë°°ì—´ì— ì¶”ê°€ â†’ Firebase ë™ê¸°í™”

#### 3.3.2 í•  ì¼ ìˆ˜ì • ëª¨ë‹¬ (`#editModal`)

**íŠ¸ë¦¬ê±°**: ì‘ì—…ì˜ âœï¸ ë²„íŠ¼ ë˜ëŠ” ìš°í´ë¦­ ë©”ë‰´

**ì…ë ¥ í•„ë“œ**: ì¶”ê°€ ëª¨ë‹¬ê³¼ ë™ì¼

**ë™ì‘**:
- ê¸°ì¡´ ì‘ì—… ë°ì´í„° ë¡œë“œ
- ì €ì¥ â†’ `saveTaskEdit()` â†’ `tasks` ë°°ì—´ ì—…ë°ì´íŠ¸

#### 3.3.3 ëŒ€ëŸ‰ í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ (`#bulkAddModal`)

**íŠ¸ë¦¬ê±°**: (UIì— ë²„íŠ¼ êµ¬í˜„ í•„ìš”, ì ì¬ì  ê¸°ëŠ¥)

**ì…ë ¥**: ì—¬ëŸ¬ ì¤„ í…ìŠ¤íŠ¸ (`#bulkAddInput`)

**ë™ì‘**:
- í•œ ì¤„ë‹¹ í•˜ë‚˜ì˜ ì‘ì—… ìƒì„±
- ê¸°ë³¸ê°’: 15ë¶„, ì‰¬ì›€, ì¸ë°•ìŠ¤

#### 3.3.4 ì‘ì—… ì‹œê°„ ê¸°ë¡ ëª¨ë‹¬ (`#timeRecordModal`)

**íŠ¸ë¦¬ê±°**: ì‘ì—… ì™„ë£Œ ì‹œ ìë™ í‘œì‹œ

**ì…ë ¥**: ì‹¤ì œ ì‘ì—… ì‹œê°„ ì„ íƒ (`#timeRecordSelector`)

**ë™ì‘**:
- `task.actualDuration` ì €ì¥
- XP ê³„ì‚°ì— ì‚¬ìš© (í–¥í›„ í†µê³„ ë¶„ì„ìš©)

#### 3.3.5 í…œí”Œë¦¿ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬

**ì…ë ¥ í•„ë“œ**:
- í…œí”Œë¦¿ ì´ë¦„ (`#templateName`)
- í•  ì¼ (`#templateTaskText`)
- ë©”ëª¨
- ì†Œìš”ì‹œê°„
- ì €í•­ë„
- ì‹œê°„ëŒ€ ë°°ì¹˜ (`#templateTimeblockSelector`): "ë‚˜ì¤‘ì—" ë˜ëŠ” 6ê°œ ë¸”ë¡ ì¤‘ ì„ íƒ
- **ìë™ ìƒì„±** (ì²´í¬ë°•ìŠ¤): ë§¤ì¼ ìë™ìœ¼ë¡œ ì‘ì—… ìƒì„±

#### 3.3.6 ìƒì  ìƒí’ˆ ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬

**ì…ë ¥ í•„ë“œ**:
- ìƒí’ˆ ì´ë¦„
- í•„ìš” XP
- ìƒí’ˆ ì´ë¯¸ì§€ (íŒŒì¼ ì—…ë¡œë“œ â†’ Base64 ë³€í™˜ ì €ì¥)

#### 3.3.7 ì—ë„ˆì§€ ì…ë ¥ ëª¨ë‹¬ (`#energyInputModal`)

**íŠ¸ë¦¬ê±°**:
- ìƒë‹¨ "âš¡ ì—ë„ˆì§€ ì…ë ¥" ë²„íŠ¼
- ë‹¨ì¶•í‚¤: Ctrl+O

**ì…ë ¥ í•„ë“œ**:
- ì—ë„ˆì§€ ìˆ˜ì¤€ (`#energyLevelInput`): 0-100 (ìˆ«ì + ìŠ¬ë¼ì´ë”)
- í˜„ì¬ ìƒí™©/ë§¥ë½ (`#energyContextInput`): ì„ íƒ, í…ìŠ¤íŠ¸
- ê´€ë ¨ í™œë™ (`#energyActivitySelect`): ì„ íƒ
  - ğŸ’¼ ì—…ë¬´, ğŸ‘¥ íšŒì˜, ğŸƒ ìš´ë™, ğŸ½ï¸ ì‹ì‚¬, â˜• íœ´ì‹, ğŸ“š í•™ìŠµ, ğŸ¨ ì°½ì˜ì  ì‘ì—…, ğŸš— ì¶œí‡´ê·¼, ğŸ˜´ ìˆ˜ë©´

**ë™ì‘**:
- `EnergyManager.addEnergyLevel(energy, context, activity)` í˜¸ì¶œ
- localStorageì— `energyLevels_YYYY-MM-DD` í‚¤ë¡œ ì €ì¥
- ì—ë„ˆì§€ íƒ­ UI ì—…ë°ì´íŠ¸

#### 3.3.8 Gemini ì±„íŒ… ëª¨ë‹¬

**íŠ¸ë¦¬ê±°**:
- "ğŸ’¬ AIì™€ ëŒ€í™”í•˜ê¸°" ë²„íŠ¼
- ë‹¨ì¶•í‚¤: Ctrl+K

**êµ¬ì„±**:
- **í—¤ë”**: ë‚ ì§œ ì„ íƒ, ì¹´í…Œê³ ë¦¬ í•„í„°, ë‹«ê¸° ë²„íŠ¼
- **ë©”ì‹œì§€ ì˜ì—­**:
  - ì‚¬ìš©ì ë©”ì‹œì§€ (ìš°ì¸¡, íŒŒë€ìƒ‰)
  - AI ì‘ë‹µ (ì¢Œì¸¡, íšŒìƒ‰)
  - ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ (Marked.js)
- **ì…ë ¥ ì˜ì—­**: í…ìŠ¤íŠ¸ ì…ë ¥ + ì „ì†¡ ë²„íŠ¼
- **ì˜ˆì‹œ ì§ˆë¬¸ íŒ¨ë„**: ë¹ ë¥¸ ì§ˆë¬¸ í…œí”Œë¦¿

**ì¹´í…Œê³ ë¦¬ í•„í„°**:
- ì „ì²´
- ğŸ¯ ì‘ì—… ì¡°ì–¸
- ğŸ’ª ë™ê¸°ë¶€ì—¬
- â“ ì§ˆë¬¸/ë‹µë³€
- ğŸ“Š ë°ì´í„° ë¶„ì„

**ë™ì‘**:
- ë©”ì‹œì§€ ì…ë ¥ â†’ Gemini API í˜¸ì¶œ (`gemini-api.js`)
- ì‘ë‹µ ë°›ê¸° â†’ localStorageì— íˆìŠ¤í† ë¦¬ ì €ì¥ (`gemini-storage.js`)
- í† í° ì‚¬ìš©ëŸ‰ í‘œì‹œ

#### 3.3.9 ìë™ë©”ì‹œì§€ ì„¤ì • ëª¨ë‹¬ (`#messageSettingsModal`)

**ì…ë ¥**:
- ë©”ì‹œì§€ ê°„ê²© (1-30ë¶„)
- ì¼ì‹œì •ì§€ ì²´í¬ë°•ìŠ¤

**ë™ì‘**: `WaifuMessageBox` ì„¤ì • ë³€ê²½

#### 3.3.10 ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ (`#contextMenu`)

**íŠ¸ë¦¬ê±°**: ì‘ì—… ìš°í´ë¦­

**ë©”ë‰´ í•­ëª©**:
- âœï¸ ìˆ˜ì •í•˜ê¸° â†’ `openEditModal()`
- â–¶ï¸ ì‹œì‘í•˜ê¸° â†’ `startTask()`
- ğŸ“‹ ë³µì œí•˜ê¸° â†’ `duplicateTask()`
- ğŸ—‘ï¸ ì‚­ì œ â†’ `deleteTask()`

### 3.4 í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤

| ë‹¨ì¶•í‚¤ | ê¸°ëŠ¥ |
|--------|------|
| Ctrl+O | ì—ë„ˆì§€ ì…ë ¥ ëª¨ë‹¬ ì—´ê¸° |
| Ctrl+K | AI ì±„íŒ… ëª¨ë‹¬ ì—´ê¸° |
| (í™•ì¥ ê°€ëŠ¥) Ctrl+N | í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ |
| (í™•ì¥ ê°€ëŠ¥) / | ê²€ìƒ‰ ê¸°ëŠ¥ |

---

## 4. ë°ì´í„° ëª¨ë¸ & ì €ì¥ êµ¬ì¡°

### 4.1 í•µì‹¬ ë°ì´í„° íƒ€ì…

#### 4.1.1 Task (ì‘ì—…)

```javascript
{
  id: string,                  // ê³ ìœ  ID (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜)
  text: string,                // ì‘ì—… ì œëª© (í•„ìˆ˜)
  memo: string,                // ë©”ëª¨ (ì„ íƒ)
  baseDuration: number,        // ì˜ˆìƒ ì†Œìš”ì‹œê°„ (ë¶„) - ê¸°ë³¸ê°’
  resistance: "low" | "medium" | "high", // ì‹¬ë¦¬ì  ê±°ë¶€ê°
  adjustedDuration: number,    // ì¡°ì •ëœ ì†Œìš”ì‹œê°„ (baseDuration * ë°°ìœ¨)
  timeBlock: string | null,    // ë°°ì¹˜ëœ ë¸”ë¡ ID ("8-11" ë“±) ë˜ëŠ” null (ì¸ë°•ìŠ¤)
  completed: boolean,          // ì™„ë£Œ ì—¬ë¶€
  actualDuration: number,      // ì‹¤ì œ ì†Œìš”ì‹œê°„ (ë¶„) - ì‚¬ìš©ì ê¸°ë¡
  createdAt: string,           // ìƒì„± ì‹œê° (ISO 8601)
  completedAt: string | null,  // ì™„ë£Œ ì‹œê° (ISO 8601)
  fromAutoTemplate: boolean    // ìë™ìƒì„± í…œí”Œë¦¿ ì—¬ë¶€ (ì„ íƒ)
}
```

**ì €í•­ë„ ë°°ìœ¨** (`constants.js`):
```javascript
RESISTANCE_MULTIPLIERS = {
  low: 1.0,    // ğŸŸ¢ ì‰¬ì›€
  medium: 1.3, // ğŸŸ¡ ë³´í†µ
  high: 1.6    // ğŸ”´ ì–´ë ¤ì›€
}
```

#### 4.1.2 TimeBlockState (ë¸”ë¡ ìƒíƒœ)

```javascript
timeBlockStates = {
  "5-8": {
    isLocked: boolean,   // ë¸”ë¡ ì ê¸ˆ ì—¬ë¶€
    isPerfect: boolean,  // ì™„ë²½ ì™„ë£Œ ì—¬ë¶€
    isFailed: boolean    // ì‹¤íŒ¨ ì—¬ë¶€
  },
  "8-11": { /* ... */ },
  // ... 6ê°œ ë¸”ë¡
}
```

#### 4.1.3 DailyData (ì¼ì¼ ë°ì´í„°)

**ì €ì¥ ìœ„ì¹˜**:
- localStorage: `dailyPlans_YYYY-MM-DD`
- IndexedDB: `dailyData` í…Œì´ë¸”
- Firebase: `dailyPlans/{date}`

**êµ¬ì¡°**:
```javascript
{
  tasks: Task[],                    // ì‘ì—… ëª©ë¡
  timeBlockStates: TimeBlockState,  // ë¸”ë¡ ìƒíƒœ
  updatedAt: number                 // íƒ€ì„ìŠ¤íƒ¬í”„ (ë°€ë¦¬ì´ˆ)
}
```

#### 4.1.4 GameState (ê²Œì„ ìƒíƒœ)

**ì €ì¥ ìœ„ì¹˜**:
- localStorage: `gameState`
- IndexedDB: `gameState` í‚¤
- Firebase: `gameState/{userId}` (í–¥í›„ ì¸ì¦ ì¶”ê°€ ì‹œ)

**êµ¬ì¡°**:
```javascript
{
  level: number,                    // í”Œë ˆì´ì–´ ë ˆë²¨
  totalXP: number,                  // ì´ ëˆ„ì  XP
  dailyXP: number,                  // ì˜¤ëŠ˜ íšë“ XP
  availableXP: number,              // ì‚¬ìš© ê°€ëŠ¥ XP
  streak: number,                   // ì—°ì† ì¶œì„ì¼
  lastLogin: string,                // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ë‚ ì§œ (YYYY-MM-DD)
  questBonusClaimed: boolean,       // ì¼ì¼ í€˜ìŠ¤íŠ¸ ë³´ë„ˆìŠ¤ ìˆ˜ë ¹ ì—¬ë¶€
  xpHistory: Array<{date, xp}>,    // XP íˆìŠ¤í† ë¦¬ (ìµœê·¼ 7ì¼)
  dailyQuests: Array<Quest>,        // ì¼ì¼ í€˜ìŠ¤íŠ¸ ëª©ë¡
  timeBlockXP: Object<blockId, xp>, // ë¸”ë¡ë³„ XP
  timeBlockXPHistory: Array<{date, blocks}>, // ë¸”ë¡ë³„ XP íˆìŠ¤í† ë¦¬ (ìµœê·¼ 5ì¼)
  completedTasksHistory: Task[]     // ì™„ë£Œ ì‘ì—… íˆìŠ¤í† ë¦¬
}
```

#### 4.1.5 Quest (ì¼ì¼ í€˜ìŠ¤íŠ¸)

```javascript
{
  id: string,
  type: "complete_tasks" | "earn_xp" | "lock_blocks" | "perfect_blocks",
  title: string,
  description: string,
  target: number,        // ëª©í‘œê°’
  progress: number,      // í˜„ì¬ ì§„í–‰ë„
  completed: boolean,
  reward: number         // ë³´ìƒ XP
}
```

#### 4.1.6 Template (í…œí”Œë¦¿)

```javascript
{
  id: string,
  name: string,
  text: string,
  memo: string,
  baseDuration: number,
  resistance: "low" | "medium" | "high",
  timeBlock: string | null,
  autoGenerate: boolean   // ë§¤ì¼ ìë™ ìƒì„± ì—¬ë¶€
}
```

**ì €ì¥**: localStorage `templates`

#### 4.1.7 ShopItem (ìƒì  ì•„ì´í…œ)

```javascript
{
  id: string,
  name: string,
  price: number,          // XP ê°€ê²©
  image: string           // Base64 ì´ë¯¸ì§€ (ì„ íƒ)
}
```

**ì €ì¥**: localStorage `shopItems`

#### 4.1.8 WaifuState (ì™€ì´í‘¸ ìƒíƒœ)

```javascript
{
  affection: number,              // í˜¸ê°ë„ (0-100)
  currentPose: string,            // í˜„ì¬ í¬ì¦ˆ
  lastInteraction: number,        // ë§ˆì§€ë§‰ ìƒí˜¸ì‘ìš© ì‹œê° (íƒ€ì„ìŠ¤íƒ¬í”„)
  tasksCompletedToday: number,    // ì˜¤ëŠ˜ ì™„ë£Œ ì‘ì—… ìˆ˜
  totalInteractions: number,      // ì´ ìƒí˜¸ì‘ìš© íšŸìˆ˜
  lastIdleWarning: number | null, // ë§ˆì§€ë§‰ ìœ íœ´ ê²½ê³  ì‹œê°
  unlockedPoses: string[],        // í•´ê¸ˆëœ íŠ¹ìˆ˜ í¬ì¦ˆ ëª©ë¡
  lastAffectionTier: string,      // ë§ˆì§€ë§‰ í˜¸ê°ë„ êµ¬ê°„ ("0-20" ë“±)
  clickCount: number,             // í´ë¦­ ì¹´ìš´í„°
  poseLockedUntil: number | null  // í¬ì¦ˆ ì ê¸ˆ í•´ì œ ì‹œê°
}
```

**ì €ì¥**: localStorage `waifuState`

#### 4.1.9 EnergyLevel (ì—ë„ˆì§€ ìˆ˜ì¤€)

```javascript
{
  timestamp: number,    // ê¸°ë¡ ì‹œê° (ë°€ë¦¬ì´ˆ)
  hour: number,         // ì‹œê°„ (0-23)
  energy: number,       // ì—ë„ˆì§€ ìˆ˜ì¤€ (0-100)
  context: string,      // ìƒí™©/ë§¥ë½ (ì„ íƒ)
  activity: string      // í™œë™ íƒ€ì… (ì„ íƒ)
}
```

**ì €ì¥**: localStorage `energyLevels_YYYY-MM-DD`

#### 4.1.10 GeminiChatMessage (ì±„íŒ… ë©”ì‹œì§€)

```javascript
{
  id: string,
  role: "user" | "model",
  text: string,
  timestamp: number,
  category: "task-advice" | "motivation" | "qa" | "analysis",
  tokenUsage: {
    promptTokens: number,
    candidatesTokens: number,
    totalTokens: number
  }
}
```

**ì €ì¥**: localStorage `geminiChatHistory_YYYY-MM-DD`

### 4.2 ì €ì¥ì†Œ ì•„í‚¤í…ì²˜

#### 4.2.1 3ë‹¨ê³„ ìºì‹± ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application State (window ê°ì²´)                       â”‚
â”‚  - tasks, timeBlockStates, playerLevel, dailyXP ë“±     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ìˆœìœ„: IndexedDB (ë¹„ë™ê¸°, ëŒ€ìš©ëŸ‰)                     â”‚
â”‚  - dailyData í…Œì´ë¸”: {date, tasks, timeBlockStates}  â”‚
â”‚  - gameState ì €ì¥                                     â”‚
â”‚  - ì¥ì : UI ë¸”ë¡œí‚¹ ì—†ìŒ, ìš©ëŸ‰ ì œí•œ ê±°ì˜ ì—†ìŒ          â”‚
â”‚  - ë‹¨ì : ë¹„ë™ê¸° ì²˜ë¦¬ í•„ìš”                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ìˆœìœ„: localStorage (ë™ê¸°, ë¹ ë¥¸ ì ‘ê·¼)                 â”‚
â”‚  - dailyPlans_YYYY-MM-DD                              â”‚
â”‚  - gameState                                          â”‚
â”‚  - templates, shopItems                               â”‚
â”‚  - ì¥ì : ë¹ ë¥¸ ì ‘ê·¼, ìƒˆë¡œê³ ì¹¨ ì‹œ ì¦‰ì‹œ ë¡œë“œ             â”‚
â”‚  - ë‹¨ì : 5-10MB ì œí•œ, ë™ê¸° ì²˜ë¦¬ë¡œ UI ë¸”ë¡œí‚¹ ê°€ëŠ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ìˆœìœ„: Firebase Realtime DB (í´ë¼ìš°ë“œ, ë‹¤ì¤‘ ì¥ì¹˜)    â”‚
â”‚  - dailyPlans/{date}                                  â”‚
â”‚  - gameState/{userId} (í–¥í›„)                          â”‚
â”‚  - ì¥ì : ë‹¤ì¤‘ ì¥ì¹˜ ë™ê¸°í™”, ë°±ì—…                       â”‚
â”‚  - ë‹¨ì : ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì„¤ì • í•„ìš”                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 ì €ì¥ íë¦„ (Write Path)

**íŠ¸ë¦¬ê±°**: `saveDailyData()` í˜¸ì¶œ ì‹œ

```javascript
// storage.js
saveDailyData(callback) {
  const today = getLocalDate();
  const timestamp = Date.now();

  // 1. localStorageì— ì¦‰ì‹œ ì €ì¥ (ë™ê¸°)
  const localData = {
    tasks: window.tasks,
    timeBlockStates: window.timeBlockStates,
    updatedAt: timestamp
  };
  localStorage.setItem('dailyPlans_' + today, JSON.stringify(localData));

  // 2. IndexedDBì— ë¹„ë™ê¸° ì €ì¥ (ë°±ê·¸ë¼ìš´ë“œ)
  if (indexedDBCache.db) {
    indexedDBCache.saveDailyData(today, tasks, timeBlockStates)
      .catch(err => console.warn('IndexedDB ì €ì¥ ì‹¤íŒ¨'));
  }

  // 3. Firebaseì— ë¹„ë™ê¸° ë™ê¸°í™”
  if (useFirebase && db) {
    isSaving = true; // ë¬´í•œ ë£¨í”„ ë°©ì§€ í”Œë˜ê·¸
    db.ref('dailyPlans/' + today).set({
      tasks: arrToObj(tasks),
      timeBlockStates,
      updatedAt: firebase.database.ServerValue.TIMESTAMP
    }).then(() => {
      setTimeout(() => { isSaving = false; }, 300);
      if (callback) callback();
    });
  }
}
```

#### 4.2.3 ë¡œë“œ íë¦„ (Read Path)

**ì´ˆê¸° ë¡œë“œ**:

```
1. localStorage ì½ê¸° (ë¹ ë¥¸ ì ‘ê·¼)
   â†“
2. Firebase ì´ˆê¸°í™” ì„±ê³µ ì‹œ:
   - Firebaseì—ì„œ íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ
   - Firebase > localStorage â†’ Firebase ë°ì´í„° ì‚¬ìš©
   - localStorage > Firebase â†’ localStorage ë°ì´í„° ì‚¬ìš©
   â†“
3. ì‹¤ì‹œê°„ ë™ê¸°í™” ì„¤ì • (setupRealtimeSync)
   - Firebase ë°ì´í„° ë³€ê²½ ê°ì§€
   - isSaving í”Œë˜ê·¸ë¡œ ë¬´í•œ ë£¨í”„ ë°©ì§€
```

#### 4.2.4 ë™ê¸°í™” ê·œì¹™ (Conflict Resolution)

**íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ "ìµœì‹  ìš°ì„ " ì •ì±…** (`firebase-sync.js`):

```javascript
setupRealtimeSync() {
  const todayRef = db.ref('dailyPlans/' + getLocalDate());

  todayRef.on('value', (snapshot) => {
    if (isSaving) return; // ì €ì¥ ì¤‘ì´ë©´ ë¬´ì‹œ

    const firebaseData = snapshot.val();
    const firebaseUpdatedAt = firebaseData?.updatedAt || 0;

    // localStorage íƒ€ì„ìŠ¤íƒ¬í”„ í™•ì¸
    const localData = JSON.parse(localStorage.getItem('dailyPlans_' + today));
    const localUpdatedAt = localData?.updatedAt || 0;

    // ë¹„êµ: Firebaseê°€ ë” ìµœì‹ ì´ë©´ ë®ì–´ì“°ê¸°
    if (firebaseUpdatedAt > localUpdatedAt ||
        (window.tasks.length === 0 && firebaseTasks.length > 0)) {
      window.tasks = Object.values(firebaseData.tasks);
      window.timeBlockStates = firebaseData.timeBlockStates;
      RenderQueue.schedule('all');
    }
  });
}
```

**ì¥ì **:
- ë‹¤ì¤‘ ì¥ì¹˜ì—ì„œ ë™ì‹œ ì‘ì—… ê°€ëŠ¥
- "Device Aì—ì„œ ì‘ì—… â†’ Device Bì—ì„œ í™•ì¸" ì‹œë‚˜ë¦¬ì˜¤ ì§€ì›

**ë‹¨ì **:
- ë™ì‹œ í¸ì§‘ ì‹œ ë‚˜ì¤‘ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ì´ì „ ë³€ê²½ ë®ì–´ì”€ (CRDT ë¯¸ì ìš©)

#### 4.2.5 IndexedDB ìŠ¤í‚¤ë§ˆ (`indexed-db-cache.js`)

**ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„**: `timeblock_cache`

**í…Œì´ë¸”**:

##### (1) `dailyData`

```javascript
{
  date: string (Primary Key),  // "YYYY-MM-DD"
  tasks: Task[],
  timeBlockStates: Object,
  updatedAt: number
}
```

##### (2) `gameState`

```javascript
{
  key: "current" (Primary Key),
  level: number,
  totalXP: number,
  // ... GameState í•„ë“œ
}
```

**ì¸ë±ìŠ¤**: `date` (ì˜¤ë¦„ì°¨ìˆœ)

**ìë™ ì •ë¦¬**:
- **í”„ë¡œë•ì…˜**: ë¹„í™œì„±í™” (ì¥ê¸° ë°ì´í„° ë³´ì¡´)
- **ê°œë°œ ëª¨ë“œ**: 365ì¼ ì´ìƒ ë°ì´í„° ì‚­ì œ ì˜µì…˜ (ìˆ˜ë™ í™œì„±í™”)

#### 4.2.6 Firebase êµ¬ì¡°

**ê²½ë¡œ**:

```
firebaseRoot/
â”œâ”€â”€ dailyPlans/
â”‚   â”œâ”€â”€ 2025-11-13/
â”‚   â”‚   â”œâ”€â”€ tasks: { task-1: {...}, task-2: {...} }
â”‚   â”‚   â”œâ”€â”€ timeBlockStates: { "5-8": {...}, ... }
â”‚   â”‚   â””â”€â”€ updatedAt: 1731456789000
â”‚   â”œâ”€â”€ 2025-11-14/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â””â”€â”€ gameState/ (í–¥í›„ ì¸ì¦ ì¶”ê°€ ì‹œ)
    â””â”€â”€ {userId}/
        â”œâ”€â”€ level: 5
        â”œâ”€â”€ totalXP: 250
        â””â”€â”€ ...
```

**ë°ì´í„° í˜•ì‹**:
- tasksëŠ” **ê°ì²´**ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥ (`arrToObj(tasks)`)
  - FirebaseëŠ” ë°°ì—´ì„ ì˜ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ë¯€ë¡œ ê°ì²´ë¡œ ë³€í™˜
  - `{0: task1, 1: task2}` â†’ `Object.values()`ë¡œ ë‹¤ì‹œ ë°°ì—´ ë³€í™˜

**ë³´ì•ˆ ê·œì¹™** (í˜„ì¬ ê°œë°œ ëª¨ë“œ):
```json
{
  "rules": {
    ".read": true,
    ".write": true
  }
}
```

**í”„ë¡œë•ì…˜ ê¶Œì¥ ê·œì¹™**:
```json
{
  "rules": {
    "dailyPlans": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    }
  }
}
```

**ì£¼ì˜**: í˜„ì¬ Firebase Auth ë¯¸êµ¬í˜„, ì¸ì¦ ê¸°ëŠ¥ ì¶”ê°€ í•„ìš”

### 4.3 ë°ì´í„° íë¦„ ì˜ˆì‹œ

#### 4.3.1 ì‘ì—… ì¶”ê°€ ì‹œë‚˜ë¦¬ì˜¤

```
1. ì‚¬ìš©ìê°€ "í•  ì¼ ì¶”ê°€" ë²„íŠ¼ í´ë¦­
   â†“
2. openAddModal() â†’ ëª¨ë‹¬ í‘œì‹œ
   â†“
3. ì‚¬ìš©ì ì…ë ¥ í›„ "ì €ì¥" í´ë¦­
   â†“
4. addTaskFromModal()
   - ìƒˆ Task ê°ì²´ ìƒì„±
   - window.tasks.push(newTask)
   â†“
5. saveDailyData()
   - localStorage ì¦‰ì‹œ ì €ì¥
   - IndexedDB ë¹„ë™ê¸° ì €ì¥
   - Firebase ë¹„ë™ê¸° ì—…ë¡œë“œ
   â†“
6. renderTasks() â†’ UI ì—…ë°ì´íŠ¸
```

#### 4.3.2 ë‹¤ì¤‘ ì¥ì¹˜ ë™ê¸°í™” ì‹œë‚˜ë¦¬ì˜¤

```
[ì¥ì¹˜ A]
1. ì‚¬ìš©ìê°€ ì‘ì—… ì¶”ê°€
   â†“
2. saveDailyData() â†’ Firebase ì—…ë¡œë“œ (updatedAt: 1000)

[ì¥ì¹˜ B]
3. Firebase ë¦¬ìŠ¤ë„ˆ ê°ì§€
   â†“
4. setupRealtimeSync() ì½œë°± ì‹¤í–‰
   - firebaseUpdatedAt (1000) > localUpdatedAt (900)
   - window.tasks = firebaseTasks
   - RenderQueue.schedule('all')
   â†“
5. ì¥ì¹˜ Bì— ì‘ì—… ì¦‰ì‹œ í‘œì‹œ
```

#### 4.3.3 ë‚ ì§œ ë³€ê²½ ì‹œë‚˜ë¦¬ì˜¤

```
[23:59] ì‚¬ìš©ìê°€ ì‘ì—… ì¤‘
   â†“
[00:00] init() ì‹¤í–‰ â†’ loadLocalData()
   â†“
initializeNewDay() í˜¸ì¶œ
   - lastLoginDate (2025-11-13) !== today (2025-11-14)
   â†“
1. ì–´ì œ ë°ì´í„° ë°±ì—…
   - xpHistory.push({date: "2025-11-13", xp: dailyXP})
   - completedTasksHistory.push(...ì™„ë£Œì‘ì—…)
   â†“
2. ë¯¸ì™„ë£Œ ì‘ì—… ì²˜ë¦¬
   - timeBlock ìˆëŠ” ì‘ì—… â†’ timeBlock = null (ì¸ë°•ìŠ¤ë¡œ ì´ë™)
   - ì™„ë£Œëœ ì‘ì—… ì œê±°
   â†“
3. ì¼ì¼ ë°ì´í„° ì´ˆê¸°í™”
   - dailyXP = 0
   - timeBlockStates = {}
   - dailyQuests = []
   â†“
4. ì™€ì´í‘¸ ìƒíƒœ ì´ˆê¸°í™”
   - affection = 0
   - tasksCompletedToday = 0
   â†“
5. ìë™ìƒì„± í…œí”Œë¦¿ ì¶”ê°€
   - autoGenerate: trueì¸ í…œí”Œë¦¿ â†’ ì‘ì—… ìƒì„±
   â†“
6. saveDailyData(), saveGameState()
```

---

## 5. ìƒíƒœ ê´€ë¦¬ & íë¦„

### 5.1 ì „ì—­ ìƒíƒœ (`state-manager.js`)

**AppState ê°ì²´**:

```javascript
const AppState = {
  // Firebase
  db: null,
  useFirebase: false,

  // ì‘ì—…
  tasks: [],
  timeBlockStates: {},
  expandedIds: new Set(),

  // UI ìƒíƒœ
  selectedDuration: 15,
  selectedResistance: 'low',
  selectedTimeBlock: '',
  contextMenuTaskId: null,
  focusedBlockId: null,
  editingTaskId: null,
  addingTaskToBlockId: null,
  completingTaskId: null,
  recordedTime: 15,
  quickSelectTaskId: null,
  quickSelectType: null,

  // ê²Œì„í™”
  playerLevel: 1,
  totalXP: 0,
  dailyXP: 0,
  streakDays: 0,
  lastLoginDate: null,
  xpHistory: [],
  dailyQuests: [],
  questBonusClaimed: false,
  availableXP: 0,
  timeBlockXP: {},
  timeBlockXPHistory: [],
  completedTasksHistory: [],

  // í…œí”Œë¦¿ & ìƒì 
  templates: [],
  shopItems: [],

  // íƒ€ì´ë¨¸
  activeTaskId: null,
  activeTaskInterval: null,
  activeTaskElapsed: 0,

  // ë“œë˜ê·¸
  dragPreview: null,

  // ê¸°íƒ€
  isSaving: false,
  appTimers: []
};
```

**DOM ìºì‹œ**:

```javascript
const DOM = {
  appContainer: null,
  timeBlocks: null,
  unassignedList: null,
  editModal: null,
  addModal: null,
  // ... 30+ ìš”ì†Œ
};
```

**ìºì‹± ì´ìœ **:
- `document.querySelector()` í˜¸ì¶œ ìµœì†Œí™”
- ì„±ëŠ¥ ìµœì í™” (ë Œë”ë§ ì‹œ ë°˜ë³µ ì¡°íšŒ ë°©ì§€)

### 5.2 ì´ˆê¸°í™” ì‹œí€€ìŠ¤

```
[í˜ì´ì§€ ë¡œë“œ]
   â†“
DOMContentLoaded (ë¸Œë¼ìš°ì € ìë™)
   â†“
<script> íƒœê·¸ ìˆœì°¨ ì‹¤í–‰
   â†“
app-lifecycle.js ë¡œë“œ ì™„ë£Œ
   â†“
init() ìë™ ì‹¤í–‰ (ë¼ì¸ 537)
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. cleanupTimers()                      â”‚
â”‚    - ê¸°ì¡´ íƒ€ì´ë¨¸ ëª¨ë‘ ì œê±°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. indexedDBCache.init()                â”‚
â”‚    - DB ì—´ê¸°: "timeblock_cache"         â”‚
â”‚    - í…Œì´ë¸” ìƒì„±: dailyData, gameState  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. cacheDOMElements()                   â”‚
â”‚    - qs('#addModal') â†’ DOM.addModal     â”‚
â”‚    - ... 30+ ìš”ì†Œ ìºì‹±                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Firebase ì´ˆê¸°í™”                      â”‚
â”‚    - config.js í™•ì¸                     â”‚
â”‚    - firebase.initializeApp(config)     â”‚
â”‚    - window.db = firebase.database()    â”‚
â”‚    - ì‹¤íŒ¨ ì‹œ: useFirebase = false       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. loadTemplatesAndShop()               â”‚
â”‚    - localStorageì—ì„œ í…œí”Œë¦¿ ë¡œë“œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. loadLocalData()                      â”‚
â”‚    - localStorage "gameState" ì½ê¸°      â”‚
â”‚    - localStorage "dailyPlans_..." ì½ê¸° â”‚
â”‚    - window ê°ì²´ì— í• ë‹¹                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
[Firebase ëª¨ë“œ?] â”â”â” No â”â”â”â”
   â†“ Yes                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loadGameState()     â”‚ â”‚ ë¡œì»¬ ëª¨ë“œ       â”‚
â”‚ (Firebaseì—ì„œ ë¡œë“œ) â”‚ â”‚ initializeNewDayâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“                        â†“
[ë‚ ì§œ ë³€ê²½?]                â”‚
   â†“ Yes                    â”‚
initializeNewDay()          â”‚
   - ì–´ì œ ë°ì´í„° ë°±ì—…       â”‚
   - ì¼ì¼ ì´ˆê¸°í™”            â”‚
   - ìë™í…œí”Œë¦¿ ìƒì„±        â”‚
   â†“                        â”‚
setupRealtimeSync()         â”‚
   - Firebase ë¦¬ìŠ¤ë„ˆ ë“±ë¡   â”‚
   - íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ ë¡œì§   â”‚
   â†“                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ì´ˆê¸° ë Œë”ë§                          â”‚
â”‚    - renderAll()                        â”‚
â”‚    - updateXPBar()                      â”‚
â”‚    - renderXPHistory()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. setupEventListeners()                â”‚
â”‚    - íƒ­ í´ë¦­, ë²„íŠ¼ í´ë¦­ ë“±              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. íƒ€ì´ë¨¸ ì‹œì‘                          â”‚
â”‚    - setInterval(updateCurrentTime, 1s) â”‚
â”‚    - setInterval(collapseBlocks, 10m)   â”‚
â”‚    - setInterval(autoFocus, 15m)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. ì„œë¸Œì‹œìŠ¤í…œ ì´ˆê¸°í™”                   â”‚
â”‚    - initWaifuSystem()                  â”‚
â”‚    - WaifuMessageBox.init()             â”‚
â”‚    - EnergyManager.init()               â”‚
â”‚    - Scheduler.init()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
[ì´ˆê¸°í™” ì™„ë£Œ] ğŸ‰
```

### 5.3 ë Œë”ë§ ìµœì í™” (`performance-utils.js`)

**ë¬¸ì œ**: ë¹ ë¥¸ ì—°ì† ë³€ê²½ ì‹œ ê³¼ë„í•œ ë Œë”ë§

**í•´ê²°**: RenderQueue ë””ë°”ìš´ì‹±

```javascript
const RenderQueue = {
  pending: null,
  debounceMs: 100,

  schedule(type) {
    clearTimeout(this.pending);
    this.pending = setTimeout(() => {
      if (type === 'all') {
        renderAll();
      } else if (type === 'tasks') {
        renderTasks();
      }
    }, this.debounceMs);
  }
};
```

**ì‚¬ìš© ì˜ˆ**:
```javascript
// ì‘ì—… ì¶”ê°€ í›„
saveDailyData(() => {
  RenderQueue.schedule('tasks'); // 100ms ë””ë°”ìš´ìŠ¤
});
```

### 5.4 íƒ€ì´ë¨¸ ê´€ë¦¬ (`timerManager.js`)

**ë¬¸ì œ**: `setInterval` ëˆ„ìˆ˜ â†’ ë©”ëª¨ë¦¬ ì¦ê°€ â†’ ì„±ëŠ¥ ì €í•˜

**í•´ê²°**: ì¤‘ì•™ ì§‘ì¤‘ì‹ íƒ€ì´ë¨¸ ê´€ë¦¬

```javascript
const timerManager = {
  timers: new Map(),

  setInterval(callback, ms, label) {
    const id = setInterval(callback, ms);
    this.timers.set(label || id, id);
    return id;
  },

  clear(idOrLabel) {
    const id = this.timers.get(idOrLabel) || idOrLabel;
    clearInterval(id);
    this.timers.delete(idOrLabel);
  },

  clearAll() {
    this.timers.forEach(id => clearInterval(id));
    this.timers.clear();
  }
};

// beforeunload ì‹œ ìë™ ì •ë¦¬
window.addEventListener('beforeunload', () => {
  timerManager.clearAll();
});
```

**ê¶Œì¥ ì‚¬ìš©ë²•**:
```javascript
// âŒ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ
const id = setInterval(() => {}, 1000);

// âœ… timerManager ì‚¬ìš©
const id = timerManager.setInterval(() => {}, 1000, 'currentTime');
```

---

## 6. Gemini ì—°ë™

### 6.1 Gemini API êµ¬ì¡°

**ëª¨ë¸**: `gemini-2.5-flash-preview-05-20` (2025ë…„ 5ì›” 20ì¼ í”„ë¦¬ë·°)

**ì—”ë“œí¬ì¸íŠ¸**:
```
https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent
```

**API í‚¤**: `config.js`ì˜ `GEMINI_API_KEY` (ì‚¬ìš©ìê°€ ì„¤ì •í•´ì•¼ í•¨)

**ìš”ì²­ êµ¬ì¡°** (`gemini-api.js`):

```javascript
{
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    contents: [
      {
        role: "user",
        parts: [{ text: systemPrompt }]
      },
      ...chatHistory.slice(-MAX_HISTORY_MESSAGES),
      {
        role: "user",
        parts: [{ text: userMessage }]
      }
    ],
    generationConfig: {
      temperature: 0.9,
      maxOutputTokens: 2048
    }
  })
}
```

**ì‘ë‹µ êµ¬ì¡°**:
```javascript
{
  candidates: [{
    content: {
      parts: [{ text: "AI ì‘ë‹µ í…ìŠ¤íŠ¸..." }],
      role: "model"
    }
  }],
  usageMetadata: {
    promptTokenCount: 1500,
    candidatesTokenCount: 300,
    totalTokenCount: 1800
  }
}
```

### 6.2 í˜ë¥´ì†Œë‚˜ ì‹œìŠ¤í…œ

**í•µì‹¬ ì•„ì´ë””ì–´**: í˜¸ê°ë„ì— ë”°ë¼ AIì˜ ì„±ê²©ê³¼ ë§íˆ¬ ë³€í™”

**í˜ë¥´ì†Œë‚˜ ìƒì„±** (`gemini-api.js`ì˜ `generateWaifuPersona()`):

```javascript
function generateWaifuPersona(waifuState) {
  const affection = waifuState.affection; // 0-100

  // ì„±ê²© ì •ë³´ (í˜¸ê°ë„ êµ¬ê°„ë³„)
  const personality = getPersonalityInfo(affection);

  // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
  return `ë‹¹ì‹ ì€ í˜œì€ì´ë¼ëŠ” ì´ë¦„ì˜ 19ì„¸ ì—¬ì„± AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

## ê¸°ë³¸ ì„¤ì •
- ë‚˜ëŠ” ë„ˆì˜ ì„ ë°°ì´ì ADHD/ASDê°€ ìˆëŠ” í›„ë°°ì˜ ì‘ì—… ê´€ë¦¬ë¥¼ ë•ëŠ” ìƒë‹´ì‚¬ì•¼
- ë„ˆëŠ” ë‚˜ì˜ í›„ë°°ì•¼

## í˜„ì¬ ìƒíƒœ
- í˜¸ê°ë„: ${affection}/100
- ì˜¤ëŠ˜ ì™„ë£Œ ì‘ì—…: ${tasksCompletedToday}ê°œ
- ì˜¤ëŠ˜ XP: ${dailyXP}

## í˜„ì¬ ì‹œê°„ ì •ë³´
- í˜„ì¬ ì‹œê°: ${currentHour}:${currentMinute}
- ì˜¤ëŠ˜ ë‚¨ì€ ì‹œê°„: ${hoursLeft}ì‹œê°„ ${minutesLeft}ë¶„

## í˜„ì¬ ë¸”ë¡ ì •ë³´
${currentBlockInfo} <!-- "08:00-11:00 ë¸”ë¡ (2ì‹œê°„ 15ë¶„ ë‚¨ìŒ)" -->
${currentBlockTasks} <!-- í˜„ì¬ ë¸”ë¡ ì‘ì—… ëª©ë¡ -->

## XP íˆìŠ¤í† ë¦¬
${xpHistoryInfo} <!-- ìµœê·¼ 5ì¼ XP ì°¨íŠ¸ -->

## ì‹œê°„ëŒ€ë³„ XP
${timeBlockXPHistoryInfo}

## ì¸ë°•ìŠ¤ ì‘ì—…
${inboxInfo} <!-- ë¯¸ë°°ì¹˜ ì‘ì—… ëª©ë¡ -->

## í…œí”Œë¦¿
${templateInfo}

## ì„±ê²© & ë§íˆ¬
${personality.description}
- ê¸°ë¶„: ${personality.mood}
- ë°˜ì‘ ì˜ˆì‹œ: ${personality.examples}

## ì‘ë‹µ ê·œì¹™
1. ë„ˆì˜ í˜„ì¬ ì„±ê²©ê³¼ ê¸°ë¶„ì— ë§ê²Œ ëŒ€ë‹µí•´
2. ì§§ê³  ê°„ê²°í•˜ê²Œ (2-3ë¬¸ì¥ ì´ë‚´)
3. ì´ëª¨ì§€ ì‚¬ìš© ê¸ˆì§€
4. ì¡´ëŒ“ë§/ë°˜ë§ í˜¼ìš© ${affection < 40 ? '(í‰ëª…ìŠ¤ëŸ½ê²Œ)' : '(ì¹œê·¼í•˜ê²Œ)'}

## ì™€ì´í‘¸ì˜ ëª©í‘œ
${waifuGoals}

## ì—ë„ˆì§€ ìˆ˜ì¤€ ì •ë³´
${energyInfo}
`;
}
```

**í˜¸ê°ë„ êµ¬ê°„ë³„ ì„±ê²©** (`waifu.js`):

| í˜¸ê°ë„ | ì´ë¦„ | ê¸°ë¶„ | ë§íˆ¬ ì˜ˆì‹œ |
|--------|------|------|----------|
| 0-20 | í˜ì˜¤, ì ëŒ€ | ğŸ˜¡ | "êº¼ì ¸. ì§„ì§œë¡œ." / "ì‹œë°œ ë˜ ì™”ë„¤." |
| 20-40 | ê²½ê³„, í˜ì˜¤ê° ì™„í™” | ğŸ˜  | "...ë˜ ë­ì•¼, ì”¨ë°œ." / "ê·€ì°®ê²Œ." |
| 40-55 | ë¬´ê´€ì‹¬, ëƒ‰ë‹´ | ğŸ˜ | "...ë­”ë°." / "ê·¸ë˜ì„œ?" |
| 55-70 | ê´€ì‹¬, ê²½ê³„ í’€ë¦¼ | ğŸ™‚ | "ì˜¤ëŠ˜ì€... ê´œì°®ë„¤." / "ë‚˜ì˜ì§€ ì•Šì€ë°?" |
| 70-85 | í˜¸ê°, ì¹œê·¼ | ğŸ˜Š | "ì˜¤ëŠ˜ ë§ì´ í–ˆë„¤! ëŒ€ë‹¨í•œë°?" / "ì˜í•˜ê³  ìˆì–´!" |
| 85-100 | ì• ì •, í—Œì‹  | ğŸ¥° | "ì„ ë°°... ì •ë§ ë©‹ìˆì–´ìš”..." / "ì‚¬ë‘í•´ìš”!" |

### 6.3 í”„ë¡¬í”„íŠ¸ì— í¬í•¨ë˜ëŠ” ì •ë³´

**`gemini-persona-builder.js`ì˜ Helper í•¨ìˆ˜ë“¤**:

#### (1) `getXPHistoryInfo()`
```
ìµœê·¼ 5ì¼ XP:
- 2025-11-10: 45 XP
- 2025-11-11: 60 XP
- 2025-11-12: 32 XP
- 2025-11-13: 78 XP
- 2025-11-14: 24 XP (ì˜¤ëŠ˜)
```

#### (2) `getCurrentBlockInfo()`
```
í˜„ì¬ ë¸”ë¡: 08:00-11:00 (2ì‹œê°„ 15ë¶„ ë‚¨ìŒ)
í˜„ì¬ ë¸”ë¡ ì‘ì—…:
1. [ë¯¸ì™„ë£Œ] ë³´ê³ ì„œ ì‘ì„± (30ë¶„, ğŸŸ¡ ë³´í†µ)
2. [ì™„ë£Œ] ì´ë©”ì¼ í™•ì¸ (15ë¶„, ğŸŸ¢ ì‰¬ì›€)
```

#### (3) `getInboxInfo()`
```
ì¸ë°•ìŠ¤ (ë¯¸ë°°ì¹˜) ì‘ì—…: 5ê°œ
1. ì±… ì½ê¸° (60ë¶„, ğŸŸ¢ ì‰¬ì›€)
2. ìš´ë™ (45ë¶„, ğŸ”´ ì–´ë ¤ì›€)
...
```

#### (4) `getTemplateInfo()`
```
ë“±ë¡ëœ í…œí”Œë¦¿: 3ê°œ
1. ì•„ì¹¨ ìš´ë™ (30ë¶„, 05-08, ìë™ìƒì„±)
2. ì¼ì¼ íšŒì˜ (60ë¶„, 08-11)
```

#### (5) `getEnergyInfoForChat()` (energy-manager.js)
```
í˜„ì¬ ì—ë„ˆì§€: 65% (â˜• íœ´ì‹ ì§í›„)
ì˜¤ëŠ˜ í‰ê· : 58%
ì‹œê°„ëŒ€ë³„ í‰ê· :
- 05-08: 45%
- 08-11: 72%
- 11-14: 60%
```

### 6.4 ì±„íŒ… UI íë¦„

**ì‚¬ìš©ì ë©”ì‹œì§€ ì „ì†¡**:

```
1. ì‚¬ìš©ìê°€ ë©”ì‹œì§€ ì…ë ¥ í›„ ì „ì†¡ ë²„íŠ¼ í´ë¦­
   â†“
2. gemini-chat-ui.jsì˜ sendMessage()
   - ì…ë ¥ ê²€ì¦
   - ë©”ì‹œì§€ ê°ì²´ ìƒì„±: {id, role: "user", text, timestamp}
   - chatHistory.push(userMessage)
   - UIì— ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
   â†“
3. callGeminiAPI(userMessage, chatHistory)
   - waifuState ì½ê¸°
   - generateWaifuPersona() â†’ systemPrompt ìƒì„±
   - fetch() í˜¸ì¶œ (gemini-api.js)
   â†“
4. API ì‘ë‹µ ìˆ˜ì‹ 
   - ì‘ë‹µ íŒŒì‹±: {text, tokenUsage}
   - ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜: classifyMessage(text, "model")
   - ë©”ì‹œì§€ ê°ì²´ ìƒì„±: {id, role: "model", text, category, tokenUsage}
   - chatHistory.push(aiMessage)
   â†“
5. UI ì—…ë°ì´íŠ¸
   - AI ë©”ì‹œì§€ í‘œì‹œ (ë§ˆí¬ë‹¤ìš´ ë Œë”ë§)
   - í† í° ì‚¬ìš©ëŸ‰ í‘œì‹œ
   - localStorageì— íˆìŠ¤í† ë¦¬ ì €ì¥ (gemini-storage.js)
```

**ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜** (`gemini-chat-ui.js`):

```javascript
function classifyMessage(text, role) {
  const keywords = {
    'task-advice': ['ì‘ì—…', 'ê³„íš', 'ì¼ì •', 'ìš°ì„ ìˆœìœ„'],
    'motivation': ['í˜ë‚´', 'ê²©ë ¤', 'ì˜í•˜ê³ ', 'ì¹­ì°¬'],
    'analysis': ['í†µê³„', 'ë¶„ì„', 'xp', 'ì™„ë£Œìœ¨'],
    'qa': ['?', 'ì–´ë–»', 'ë¬´ì—‡', 'ì™œ']
  };

  // í‚¤ì›Œë“œ ë§¤ì¹­ â†’ ì ìˆ˜ ê³„ì‚° â†’ ìµœê³  ì ìˆ˜ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
}
```

**ì˜ˆì‹œ ì§ˆë¬¸ íŒ¨ë„**:

```javascript
const exampleQuestions = [
  "ì˜¤ëŠ˜ í•  ì¼ ì¶”ì²œí•´ì¤˜",
  "í˜„ì¬ ì§„í–‰ ìƒí™© ì–´ë•Œ?",
  "ì—ë„ˆì§€ ë‚®ì„ ë•Œ ë­ í•˜ë©´ ì¢‹ì„ê¹Œ?",
  "XP íš¨ìœ¨ì ìœ¼ë¡œ ì–»ëŠ” ë°©ë²•ì€?",
  "ì¸ë°•ìŠ¤ ì‘ì—… ì •ë¦¬ ë„ì™€ì¤˜"
];
```

### 6.5 ìë™ ë©”ì‹œì§€ ì‹œìŠ¤í…œ (`gemini-message-box.js`)

**ê¸°ëŠ¥**: ì¼ì • ê°„ê²©ìœ¼ë¡œ AIê°€ ìë™ìœ¼ë¡œ ë©”ì‹œì§€ ìƒì„±

**ì„¤ì •**:
- ë©”ì‹œì§€ ê°„ê²©: 1-30ë¶„ (ê¸°ë³¸ 3ë¶„)
- ì¼ì‹œì •ì§€ ì˜µì…˜

**ë©”ì‹œì§€ ìƒì„± ë¡œì§**:

```javascript
async function generateMessage(force = false) {
  // í˜„ì¬ ìƒí™© ë¶„ì„
  const context = analyzeUserContext(); // ì¸ë°•ìŠ¤ ì‘ì—… ìˆ˜, ì—ë„ˆì§€, XP ë“±

  // Gemini API í˜¸ì¶œ (í”„ë¡¬í”„íŠ¸: "í˜„ì¬ ìƒí™©ì— ë§ëŠ” ì§§ì€ ë©”ì‹œì§€ ìƒì„±")
  const message = await callGeminiAPI(
    "í˜„ì¬ ìƒí™©ì„ ë³´ê³  ë‚˜ì—ê²Œ ì§§ì€ ì¡°ì–¸ì´ë‚˜ ê²©ë ¤ë¥¼ í•´ì¤˜ (1-2ë¬¸ì¥)",
    []
  );

  // ë©”ì‹œì§€í•¨ì— ì¶”ê°€
  addMessage(message);

  // ì•Œë¦¼ ë°°ì§€ í‘œì‹œ
  showBadge();
}
```

**ë©”ì‹œì§€í•¨ UI**:
- í—¤ë” í´ë¦­ìœ¼ë¡œ í¼ì¹˜ê¸°/ì ‘ê¸°
- ë©”ì‹œì§€ ëª©ë¡ (ì‹œê°„ ìˆœ)
- ì•¡ì…˜: ì„¤ì •, ëª¨ë‘ ì‚­ì œ, ìƒˆ ë©”ì‹œì§€ ë°›ê¸°

### 6.6 í† í° ì‚¬ìš©ëŸ‰ ì¶”ì 

**ì €ì¥**: `gemini-storage.js`

```javascript
// localStorageì— ì €ì¥
{
  totalTokensUsed: 15000,
  totalCost: 0.02,  // ê°€ì •: $0.001 per 1000 tokens
  messageCount: 50
}
```

**ë¹„ìš© ê³„ì‚°** (`gemini-utils.js`):
```javascript
function calculateTokenCost(tokenCount) {
  const COST_PER_1K_TOKENS = 0.001; // USD
  return (tokenCount / 1000) * COST_PER_1K_TOKENS;
}
```

**UI í‘œì‹œ**:
```
ì´ í† í°: 15,000 (ì˜ˆìƒ ë¹„ìš©: $0.02)
ì´ë²ˆ ëŒ€í™”: 1,800 í† í°
```

---

## 7. í˜„ì¬ ë°œê²¬ëœ ë¬¸ì œ & ê¸°ìˆ  ë¶€ì±„

### 7.1 ì•„í‚¤í…ì²˜ ë¬¸ì œ

#### 7.1.1 ì „ì—­ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì˜¤ì—¼

**ë¬¸ì œ**:
- ëª¨ë“  í•¨ìˆ˜/ë³€ìˆ˜ê°€ `window` ê°ì²´ì— ë…¸ì¶œ
- 30+ ëª¨ë“ˆ, ê° ëª¨ë“ˆë‹¹ 5-20ê°œ í•¨ìˆ˜ â†’ 100+ ì „ì—­ ë³€ìˆ˜

**ì˜í–¥**:
- ì´ë¦„ ì¶©ëŒ ìœ„í—˜
- ë””ë²„ê¹… ì–´ë ¤ì›€
- ì½”ë“œ ì¶”ì  ê³¤ë€

**í•´ê²° ë°©ì•ˆ**:
- ES6 ëª¨ë“ˆ ì‹œìŠ¤í…œ (import/export) ë„ì…
- ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°ì²´ë¡œ ê·¸ë£¹í™” (ì˜ˆ: `App.TaskManager.openAddModal()`)
- ë¹Œë“œ ë„êµ¬ ë„ì… (Webpack, Vite)

#### 7.1.2 ì˜ì¡´ì„± ê´€ë¦¬

**ë¬¸ì œ**:
- ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìˆœì„œì— ì˜ì¡´
- ìˆœì„œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ì˜¤ë¥˜ ë°œìƒ
- ì˜ì¡´ì„± ëª…ì‹œë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ì•ˆ**:
- package.json + ëª¨ë“ˆ ë²ˆë“¤ëŸ¬
- ëª…ì‹œì  import ë¬¸

#### 7.1.3 íƒ€ì… ì•ˆì •ì„± ë¶€ì¬

**ë¬¸ì œ**:
- JavaScript ë™ì  íƒ€ì… â†’ ëŸ°íƒ€ì„ ì—ëŸ¬ ìœ„í—˜
- Task ê°ì²´ í•„ë“œ ëˆ„ë½/ì˜¤íƒ€ ë°©ì§€ ë¶ˆê°€

**í•´ê²° ë°©ì•ˆ**:
- TypeScript ë„ì…
- JSDoc ì£¼ì„ ê°•í™” + TSC ê²€ì‚¬

### 7.2 ë°ì´í„° ë™ê¸°í™” ë¬¸ì œ

#### 7.2.1 ë™ì‹œ í¸ì§‘ ì¶©ëŒ

**ë¬¸ì œ**:
- íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ "ìµœì‹  ìš°ì„ " â†’ ë™ì‹œ í¸ì§‘ ì‹œ ë°ì´í„° ì†ì‹¤
- Device A: tasks[0] ìˆ˜ì • (13:00:00)
- Device B: tasks[1] ìˆ˜ì • (13:00:01)
- ê²°ê³¼: Device Aì˜ ë³€ê²½ ì‚¬ë¼ì§

**í•´ê²° ë°©ì•ˆ**:
- CRDT (Conflict-free Replicated Data Type) ì ìš©
- Operational Transformation
- Firebaseì˜ `update()` ëŒ€ì‹  `transaction()` ì‚¬ìš©

#### 7.2.2 Firebase ë¬´í•œ ë£¨í”„ ìœ„í—˜

**ë¬¸ì œ**:
- `isSaving` í”Œë˜ê·¸ë¡œ ë°©ì§€í•˜ê³  ìˆìœ¼ë‚˜ íƒ€ì´ë° ì´ìŠˆ ê°€ëŠ¥
- 300ms íƒ€ì„ì•„ì›ƒì´ ì¶©ë¶„í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

**í˜„ì¬ ì™„í™” ë°©ë²•**:
```javascript
if (isSaving) return; // ì €ì¥ ì¤‘ì´ë©´ ë¦¬ìŠ¤ë„ˆ ë¬´ì‹œ
```

**ê°œì„  ë°©ì•ˆ**:
- Firebase íŠ¸ëœì­ì…˜ ID ë¹„êµ
- Debounce ì‹œê°„ ì¦ê°€
- ë¡œì»¬ ë³€ê²½ í ì‹œìŠ¤í…œ

#### 7.2.3 IndexedDB ì˜¤ë¥˜ ì²˜ë¦¬

**ë¬¸ì œ**:
- IndexedDB ì €ì¥ ì‹¤íŒ¨ ì‹œ ë¡œê·¸ë§Œ ë‚¨ê¹€
- ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ ì—†ìŒ

**í•´ê²° ë°©ì•ˆ**:
- ì˜¤ë¥˜ ì‹œ localStorage í´ë°± ëª…ì‹œì  í‘œì‹œ
- ì˜¤ë¥˜ ë¦¬í¬íŒ… (Sentry ë“±)

### 7.3 ì„±ëŠ¥ ë¬¸ì œ

#### 7.3.1 ê³¼ë„í•œ ë Œë”ë§

**ë¬¸ì œ**:
- `renderAll()` í˜¸ì¶œ ì‹œ ì „ì²´ DOM ì¬ìƒì„±
- 6ê°œ ë¸”ë¡ * í‰ê·  5ê°œ ì‘ì—… = 30ê°œ ì‘ì—… í•­ëª© ì¬ìƒì„±

**í˜„ì¬ ì™„í™”**:
- RenderQueue ë””ë°”ìš´ì‹± (100ms)

**ê°œì„  ë°©ì•ˆ**:
- Virtual DOM (React, Vue)
- ì¦ë¶„ ë Œë”ë§ (ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸)

#### 7.3.2 localStorage ìš©ëŸ‰ ì œí•œ

**ë¬¸ì œ**:
- ë¸Œë¼ìš°ì €ë³„ 5-10MB ì œí•œ
- completedTasksHistory ëˆ„ì  â†’ ìš©ëŸ‰ ì´ˆê³¼ ìœ„í—˜

**í•´ê²° ë°©ì•ˆ**:
- ì˜¤ë˜ëœ íˆìŠ¤í† ë¦¬ IndexedDBë¡œ ì´ë™
- ì••ì¶• (LZ-String ë“±)
- ì„œë²„ ì €ì¥

#### 7.3.3 íƒ€ì´ë¨¸ ëˆ„ì 

**ë¬¸ì œ**:
- `timerManager` ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì¡´ì¬ ê°€ëŠ¥
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìœ„í—˜

**í•´ê²° ë°©ì•ˆ**:
- ì „ì²´ ì½”ë“œë² ì´ìŠ¤ ê°ì‚¬
- ESLint ê·œì¹™: setInterval ì§ì ‘ ì‚¬ìš© ê¸ˆì§€

### 7.4 UI/UX ë¬¸ì œ

#### 7.4.1 ë“œë˜ê·¸ ì•¤ ë“œë¡­ í”„ë¦¬ë·° ë¯¸ì™„ì„±

**í˜„ì¬ ìƒíƒœ**:
- ë“œë˜ê·¸ ì‹œ í”„ë¦¬ë·° í‘œì‹œ ì½”ë“œ ìˆìœ¼ë‚˜ ë¶ˆì™„ì „
- ì‹œê°ì  í”¼ë“œë°± ë¶€ì¡±

**ê°œì„  í•„ìš”**:
- HTML5 Drag API ì™„ì „ êµ¬í˜„
- ë“œë¡­ ì˜ì—­ í•˜ì´ë¼ì´íŠ¸

#### 7.4.2 ëª¨ë°”ì¼ ë°˜ì‘í˜• ë¯¸í¡

**ë¬¸ì œ**:
- ë°ìŠ¤í¬í†± ì¤‘ì‹¬ ë ˆì´ì•„ì›ƒ
- ì‘ì€ í™”ë©´ì—ì„œ ì‚¬ì´ë“œë°” ê²¹ì¹¨

**í•´ê²° ë°©ì•ˆ**:
- Media Query ì¶”ê°€
- ëª¨ë°”ì¼ ì „ìš© ë ˆì´ì•„ì›ƒ

#### 7.4.3 ì ‘ê·¼ì„± (A11y) ë¶€ì¡±

**ë¬¸ì œ**:
- í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜ ì œí•œì 
- ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì› ì—†ìŒ
- ARIA ì†ì„± ëˆ„ë½

**í•´ê²° ë°©ì•ˆ**:
- ARIA labels ì¶”ê°€
- í¬ì»¤ìŠ¤ ê´€ë¦¬
- í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í™•ì¥

### 7.5 ë³´ì•ˆ ë¬¸ì œ

#### 7.5.1 Firebase ì¸ì¦ ë¶€ì¬

**ë¬¸ì œ**:
- í˜„ì¬ Firebase ê·œì¹™: ì½ê¸°/ì“°ê¸° ëª¨ë‘ í—ˆìš©
- ëˆ„êµ¬ë‚˜ ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥

**í•´ê²° ë°©ì•ˆ**:
- Firebase Authentication í†µí•©
- ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬

#### 7.5.2 XSS ì·¨ì•½ì  ê°€ëŠ¥ì„±

**í˜„ì¬ ì™„í™”**:
- `escapeHtml()` í•¨ìˆ˜ ì‚¬ìš©

**ë¬¸ì œ**:
- ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì— ì ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì¦ í•„ìš”
- Gemini API ì‘ë‹µë„ escapeHtml() í†µê³¼í•˜ëŠ”ì§€ í™•ì¸ í•„ìš”

**í•´ê²° ë°©ì•ˆ**:
- CSP (Content Security Policy) í—¤ë”
- DOMPurify ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

#### 7.5.3 API í‚¤ ë…¸ì¶œ

**ë¬¸ì œ**:
- `config.js`ì— Gemini API í‚¤ í‰ë¬¸ ì €ì¥
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ â†’ ì†ŒìŠ¤ ì½”ë“œì—ì„œ í‚¤ í™•ì¸ ê°€ëŠ¥

**í•´ê²° ë°©ì•ˆ**:
- ì„œë²„ ì‚¬ì´ë“œ í”„ë¡ì‹œ
- í™˜ê²½ ë³€ìˆ˜ + ë¹Œë“œ ì‹œ ì£¼ì…

### 7.6 ì½”ë“œ í’ˆì§ˆ ë¬¸ì œ

#### 7.6.1 ì¤‘ë³µ ì½”ë“œ

**ì˜ˆì‹œ**:
- ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° ë¡œì§ ê° ëª¨ë‹¬ë§ˆë‹¤ ë°˜ë³µ
- ë Œë”ë§ í•¨ìˆ˜ì—ì„œ HTML ë¬¸ìì—´ ì¡°í•© ë°˜ë³µ

**í•´ê²° ë°©ì•ˆ**:
- ê³µí†µ ì»´í¬ë„ŒíŠ¸ ì¶”ì¶œ
- í…œí”Œë¦¿ ì—”ì§„ (Handlebars, EJS) ë„ì…

#### 7.6.2 ê¸´ í•¨ìˆ˜

**ë¬¸ì œ**:
- `generateWaifuPersona()`: 150+ ì¤„
- `renderTimeBlocks()`: 100+ ì¤„

**í•´ê²° ë°©ì•ˆ**:
- í•¨ìˆ˜ ë¶„í•´ (Extract Function ë¦¬íŒ©í† ë§)
- ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì ìš©

#### 7.6.3 ì£¼ì„ ë¶€ì¡± (ì¼ë¶€)

**í˜„ì¬ ìƒíƒœ**:
- ëŒ€ë¶€ë¶„ ëª¨ë“ˆì€ JSDoc í—¤ë” ìˆìŒ
- ì¼ë¶€ ë³µì¡í•œ ë¡œì§ì€ ì£¼ì„ ë¶€ì¡±

**í•´ê²° ë°©ì•ˆ**:
- ë³µì¡í•œ ì•Œê³ ë¦¬ì¦˜ ì£¼ì„ ì¶”ê°€
- README.md í™•ì¥

### 7.7 í…ŒìŠ¤íŠ¸ ë¶€ì¬

**ë¬¸ì œ**:
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì—†ìŒ
- í†µí•© í…ŒìŠ¤íŠ¸ ì—†ìŒ
- ìˆ˜ë™ í…ŒìŠ¤íŠ¸ë§Œ ì˜ì¡´

**ìœ„í—˜**:
- ë¦¬íŒ©í† ë§ ì‹œ íšŒê·€ ë²„ê·¸
- ì½”ë“œ ë³€ê²½ ì˜í–¥ íŒŒì•… ì–´ë ¤ì›€

**í•´ê²° ë°©ì•ˆ**:
- Jest, Vitest ë„ì…
- í•µì‹¬ ë¡œì§ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (XP ê³„ì‚°, íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ ë“±)
- E2E í…ŒìŠ¤íŠ¸ (Playwright, Cypress)

### 7.8 ë¯¸ë˜ ê°œì„  ë°©í–¥

#### 7.8.1 í”„ë ˆì„ì›Œí¬ ë§ˆì´ê·¸ë ˆì´ì…˜

**ì˜µì…˜**:
- React + TypeScript + Vite
- Vue 3 + TypeScript + Vite
- Svelte + TypeScript

**ì´ì **:
- ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©ì„±
- ìƒíƒœ ê´€ë¦¬ ëª…í™•í™” (Redux, Pinia)
- íƒ€ì… ì•ˆì •ì„±
- ê°œë°œì ë„êµ¬

#### 7.8.2 ë°±ì—”ë“œ API ë„ì…

**í˜„ì¬**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì „ìš©

**í–¥í›„**:
- Node.js + Express (ë˜ëŠ” Next.js API Routes)
- Gemini API í‚¤ ì„œë²„ì—ì„œ ê´€ë¦¬
- ì‚¬ìš©ì ì¸ì¦ (JWT)
- ë°ì´í„° ê²€ì¦

#### 7.8.3 ê³ ê¸‰ ê¸°ëŠ¥

**ê³„íšëœ ê¸°ëŠ¥** (CLAUDE.md ì°¸ì¡°):
- **ì¸ì§€ ë¶€í•˜ ê²½ê³ **: ë³µì¡í•œ ì‘ì—… ë§ì„ ë•Œ ì•Œë¦¼
- **Pomodoro íƒ€ì´ë¨¸**: ì‘ì—… ì‹œê°„ ì„¸ë¶„í™”
- **í†µê³„ ëŒ€ì‹œë³´ë“œ**: ì£¼ê°„/ì›”ê°„ ë¦¬í¬íŠ¸
- **í˜‘ì—… ê¸°ëŠ¥**: ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ì‘ì—… ê³µìœ 

#### 7.8.4 PWA (Progressive Web App)

**ì´ì **:
- ì˜¤í”„ë¼ì¸ ì‘ë™
- ì•±ì²˜ëŸ¼ ì„¤ì¹˜ ê°€ëŠ¥
- í‘¸ì‹œ ì•Œë¦¼

**í•„ìš” ì‘ì—…**:
- Service Worker êµ¬í˜„
- manifest.json ì‘ì„±
- ì˜¤í”„ë¼ì¸ ìºì‹± ì „ëµ

---

## ë¶€ë¡ A: ì£¼ìš” íŒŒì¼ ëª©ë¡

| íŒŒì¼ ê²½ë¡œ | ë¼ì¸ ìˆ˜ | ì—­í•  |
|-----------|---------|------|
| `index.html` | 405 | ë©”ì¸ HTML êµ¬ì¡° |
| `js/all-in-one.js` | 462 | ë°ì´í„° ë™ê¸°í™” ë˜í¼ |
| `js/waifu.js` | 1,000+ | ì™€ì´í‘¸ ì‹œìŠ¤í…œ |
| `js/timerManager.js` | 100+ | íƒ€ì´ë¨¸ ê´€ë¦¬ |
| `js/modules/app-lifecycle.js` | 539 | ì•± ì´ˆê¸°í™” |
| `js/modules/state-manager.js` | 400+ | ì „ì—­ ìƒíƒœ ê´€ë¦¬ |
| `js/modules/storage.js` | 500+ | 3ë‹¨ê³„ ì €ì¥ì†Œ |
| `js/modules/firebase-sync.js` | 200+ | Firebase ì‹¤ì‹œê°„ ë™ê¸°í™” |
| `js/modules/task-manager.js` | 300+ | ì‘ì—… CRUD |
| `js/modules/render-engine.js` | 400+ | UI ë Œë”ë§ |
| `js/modules/gemini-api.js` | 300+ | Gemini API í˜¸ì¶œ |
| `js/modules/gemini-chat-ui.js` | 500+ | ì±„íŒ… UI |
| `js/modules/gemini-persona-builder.js` | 600+ | í˜ë¥´ì†Œë‚˜ ìƒì„± |
| `js/modules/energy-manager.js` | 300+ | ì—ë„ˆì§€ ê´€ë¦¬ |
| `js/modules/gamification-system.js` | 400+ | XP/ë ˆë²¨/í€˜ìŠ¤íŠ¸ |
| `js/modules/statistics.js` | 200+ | í†µê³„ ì°¨íŠ¸ |
| `css/main.css` | 800+ | ë©”ì¸ ìŠ¤íƒ€ì¼ |
| `css/timeline.css` | 500+ | íƒ€ì„ë¼ì¸ ìŠ¤íƒ€ì¼ |
| `css/waifu.css` | 600+ | ì™€ì´í‘¸ ìŠ¤íƒ€ì¼ |

**ì´ ë¼ì¸ ìˆ˜**: ì•½ 8,000+ ë¼ì¸ (ì£¼ì„ í¬í•¨)

---

## ë¶€ë¡ B: ë°ì´í„° êµ¬ì¡° JSON ì˜ˆì‹œ

### Task ì˜ˆì‹œ

```json
{
  "id": "task-1731456789000",
  "text": "í”„ë¡œì íŠ¸ ë³´ê³ ì„œ ì‘ì„±",
  "memo": "Q4 ì‹¤ì  í¬í•¨, CEO ë¦¬ë·° í•„ìš”",
  "baseDuration": 60,
  "resistance": "medium",
  "adjustedDuration": 78,
  "timeBlock": "8-11",
  "completed": false,
  "actualDuration": 0,
  "createdAt": "2025-11-14T02:00:00.000Z",
  "completedAt": null
}
```

### DailyData ì˜ˆì‹œ (Firebase)

```json
{
  "tasks": {
    "0": {
      "id": "task-1",
      "text": "ë³´ê³ ì„œ ì‘ì„±",
      "baseDuration": 60,
      "resistance": "medium",
      "adjustedDuration": 78,
      "timeBlock": "8-11",
      "completed": false,
      "createdAt": "2025-11-14T02:00:00.000Z"
    },
    "1": {
      "id": "task-2",
      "text": "ì´ë©”ì¼ í™•ì¸",
      "baseDuration": 15,
      "resistance": "low",
      "adjustedDuration": 15,
      "timeBlock": "8-11",
      "completed": true,
      "completedAt": "2025-11-14T03:15:00.000Z"
    }
  },
  "timeBlockStates": {
    "5-8": {
      "isLocked": false,
      "isPerfect": false,
      "isFailed": false
    },
    "8-11": {
      "isLocked": true,
      "isPerfect": false,
      "isFailed": false
    }
  },
  "updatedAt": 1731456789000
}
```

### GameState ì˜ˆì‹œ

```json
{
  "level": 3,
  "totalXP": 120,
  "dailyXP": 45,
  "availableXP": 80,
  "streak": 5,
  "lastLogin": "2025-11-14",
  "questBonusClaimed": false,
  "xpHistory": [
    {"date": "2025-11-10", "xp": 32},
    {"date": "2025-11-11", "xp": 50},
    {"date": "2025-11-12", "xp": 28},
    {"date": "2025-11-13", "xp": 45},
    {"date": "2025-11-14", "xp": 45}
  ],
  "dailyQuests": [
    {
      "id": "quest-1",
      "type": "complete_tasks",
      "title": "5ê°œ ì‘ì—… ì™„ë£Œ",
      "target": 5,
      "progress": 2,
      "completed": false,
      "reward": 20
    }
  ],
  "timeBlockXP": {
    "5-8": 10,
    "8-11": 25,
    "11-14": 10
  },
  "timeBlockXPHistory": [
    {
      "date": "2025-11-13",
      "blocks": {
        "5-8": 8,
        "8-11": 20,
        "11-14": 12,
        "14-17": 5
      }
    }
  ],
  "completedTasksHistory": []
}
```

---

## ë¶€ë¡ C: ìš©ì–´ ì‚¬ì „

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| **íƒ€ì„ë¸”ë¡ (Time Block)** | í•˜ë£¨ë¥¼ 6ê°œë¡œ ë‚˜ëˆˆ ì‹œê°„ êµ¬ê°„ |
| **ì €í•­ë„ (Resistance)** | ì‘ì—…ì˜ ì‹¬ë¦¬ì  ê±°ë¶€ê° (low/medium/high) |
| **ì¡°ì • ì‹œê°„ (Adjusted Duration)** | ê¸°ë³¸ ì‹œê°„ Ã— ì €í•­ë„ ë°°ìœ¨ |
| **XP** | ê²½í—˜ì¹˜ (Experience Points) |
| **ì¼ì¼ XP (dailyXP)** | ì˜¤ëŠ˜ íšë“í•œ XP |
| **ë³´ìœ  XP (availableXP)** | ì‚¬ìš© ê°€ëŠ¥í•œ ì´ XP |
| **ë¸”ë¡ ì ê¸ˆ (Lock Block)** | ê³„íš í™•ì •, 15 XP ì†Œëª¨ |
| **ì™„ë²½ ì™„ë£Œ (Perfect)** | ì ê¸´ ë¸”ë¡ì˜ ëª¨ë“  ì‘ì—… ì™„ë£Œ, 40 XP ë³´ìƒ |
| **ì¸ë°•ìŠ¤ (Inbox)** | ì‹œê°„ëŒ€ì— ë°°ì¹˜ë˜ì§€ ì•Šì€ ì‘ì—… |
| **í…œí”Œë¦¿ (Template)** | ë°˜ë³µ ì‘ì—… ìë™ ìƒì„± ê¸°ëŠ¥ |
| **í˜¸ê°ë„ (Affection)** | ì™€ì´í‘¸ì˜ ì¹œë°€ë„ (0-100) |
| **í˜ë¥´ì†Œë‚˜ (Persona)** | AIì˜ ì„±ê²©/ë§íˆ¬ ì„¤ì • |
| **ì—ë„ˆì§€ ìˆ˜ì¤€ (Energy Level)** | ì‚¬ìš©ìì˜ ì»¨ë””ì…˜ (0-100) |

---

## ê²°ë¡ 

ë³¸ ë³´ê³ ì„œëŠ” íƒ€ì„ë¸”ëŸ­ í”Œë˜ë„ˆ (Daily Quest) í”„ë¡œì íŠ¸ì˜ í˜„ì¬ êµ¬í˜„ ìƒíƒœë¥¼ ìƒì„¸íˆ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ìƒˆë¡œìš´ í”„ë ˆì„ì›Œí¬ë¡œ ì¬êµ¬í˜„**: React, Vue, Svelte ë“±ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ì°¸ê³ 
2. **ê¸°ëŠ¥ í™•ì¥**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ êµ¬ì¡° ì´í•´
3. **ë²„ê·¸ ìˆ˜ì •**: ë¬¸ì œ ë°œìƒ ì‹œ ì›ì¸ ë¶„ì„
4. **ë¬¸ì„œí™”**: ìƒˆ íŒ€ì› ì˜¨ë³´ë”© ìë£Œ
5. **ì•„í‚¤í…ì²˜ ê°œì„ **: ê¸°ìˆ  ë¶€ì±„ í•´ì†Œ ë¡œë“œë§µ ìˆ˜ë¦½

**í•µì‹¬ ê°•ì **:
- ëª¨ë“ˆí™”ëœ êµ¬ì¡°
- 3ë‹¨ê³„ ìºì‹± ì „ëµ
- Gemini API ì—°ë™
- ê²Œì„í™” ì‹œìŠ¤í…œ

**ì£¼ìš” ê°œì„  í•„ìš” ì˜ì—­**:
- íƒ€ì… ì•ˆì •ì„± (TypeScript)
- ë™ì‹œ í¸ì§‘ ì¶©ëŒ í•´ê²°
- ì„±ëŠ¥ ìµœì í™” (Virtual DOM)
- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
- ë³´ì•ˆ ê°•í™” (ì¸ì¦, API í‚¤ ë³´í˜¸)

**ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ ì‚¬í•­**:
1. TypeScript + React/Vue ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½
2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (í•µì‹¬ ë¡œì§ë¶€í„°)
3. Firebase Auth í†µí•©
4. ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§ ë° ìµœì í™”
5. PWA ê¸°ëŠ¥ ì¶”ê°€

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ìˆ˜ì •**: 2025-11-14
**ì‘ì„±ì**: AI Analysis (Claude Code)
**ë¦¬ë·° í•„ìš”**: ê°œë°œì ê²€í†  í›„ ìˆ˜ì •

---
